---
uid: 20250827141152
title: ofsp2025-06
date: 2025-08-27
update: 2025-08-27
authors:
  - name: Aerosand
    link: https://github.com/aerosand
    image: https://github.com/aerosand.png
tags:
  - ofsp2025
  - OpenFOAM
excludeSearch: false
toc: true
weight: 6
math: true
next:
prev:
comments: true
sidebar:
  exclude: false
draft: false
---

> å‚è€ƒï¼š
> - https://github.com/UnnamedMoose/BasicOpenFOAMProgrammingTutorials
> - https://www.topcfd.cn/simulation/solve/openfoam/openfoam-program/
> - https://www.tfd.chalmers.se/~hani/kurser/OS_CFD/
> - https://github.com/ParticulateFlow/OSCCAR-doc/blob/master/openFoamUserManual_PFM.pdf
> - https://www.youtube.com/watch?v=KB9HhggUi_E&ab_channel=UCLOpenFOAMWorkshop
> - http://dyfluid.com/#
> - https://ss1.xrea.com/penguinitis.g1.xrea.com/study/OpenFOAM/index.html
> 
> æ„Ÿè°¢åŸä½œè€…ä»¬çš„æ— ç§å¼•è·¯å’Œå®è´µå·¥ä½œã€‚

> å‰ç½®ï¼š
> [OpenFOAMå¼€å‘ç¼–ç¨‹åŸºç¡€05 åœºçš„åŸºæœ¬æ“ä½œ | ğ“ğ“®ğ“»ğ“¸ğ“¼ğ“ªğ“·ğ“­ (aerosand.cn)](https://aerosand.cc/ofs/ofsp2025/ofsp2025-05)

OpenFOAM ä¸­ï¼Œå½“æŸä¸€äº›ç±»å®ç°æŸä¸ªç‰¹å®šçš„åŠŸèƒ½ï¼Œå¯ä»¥æŠŠå®ƒä»¬å¼€å‘æˆåº“ã€‚

å¯¹â€œç±»â€â€œåº“â€é“¾æ¥æœ‰ç–‘é—®çš„ï¼Œè¯·å‚è€ƒ [OpenFOAMå¼€å‘ç¼–ç¨‹åŸºç¡€00 åŸºæœ¬å®ç°å’Œå¼€å‘ | ğ“ğ“®ğ“»ğ“¸ğ“¼ğ“ªğ“·ğ“­ (aerosand.cn)](https://aerosand.cn/posts/20230502112308/)

æˆ‘ä»¬å°†ä¸Šç¯‡è®¨è®ºä¸­çš„å‹åŠ›åœºã€é€Ÿåº¦åœºçš„ä¼ªè®¡ç®—å¼€å‘æˆç‹¬ç«‹çš„åº“ï¼Œç„¶ååœ¨åº”ç”¨ä¸­è°ƒç”¨å®ƒï¼Œå½“ç„¶å¼€å‘åº“ä¹Ÿå¯ä»¥è¢«ä»»ä½•åº”ç”¨è°ƒç”¨ã€‚

å»ºç«‹æœ¬æ–‡çš„é¡¹ç›®æ–‡ä»¶å¤¹å¹¶è¿›å…¥

```
// terminal
ofsp
mkdir 06_devLib
cd 06_devLib
```

## åº”ç”¨å‡†å¤‡

```
// terminal
foamNewApp 06_01_devLib
cd 06_01_devLib
cp -r $FOAM_TUTORIALS/incompressible/icoFoam/cavity/cavity debug_case
cp -r debug_case/0 debug_case/0_orig
```

åœ¨åº”ç”¨æ–‡ä»¶å¤¹ä¸­æ–°å»ºå¼€å‘åº“

```
// terminal
foamNewApp computeVelocityPressure
```


## è„šæœ¬å’Œè¯´æ˜

ç•¥ã€‚

## æ–‡ä»¶ç»“æ„

æ•´ä¸ªåº”ç”¨çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹

```
|- 06_01_devLib/
	|- computeVelocityPressure/
		|- Make/
			|- files
			|- options
		|- computeVelocityPressure.H
		|- computeVelocityPressure.C
	|- debug_case/
		|- 0/
		|- constant/
		|- system/
	|- Make/
		|- files
		|- options
	|- createFields.H
	|- 06_01_devLib.C
	|- caserun
	|- caseclean
	|- README.md
```

## å¼€å‘åº“

### å¤´æ–‡ä»¶

å¤´æ–‡ä»¶ `/userApp/computeVelocityPressure/computeVelocityPressure.H` ï¼Œå†…å®¹å¦‚ä¸‹

```cpp
#include "fvCFD.H"

scalar computeR(const fvMesh& mesh, volScalarField& r, dimensionedVector x0);

volScalarField computePressure(const fvMesh& mesh, scalar t, dimensionedVector x0, scalar scale,scalar f);

void computeVelocity(const fvMesh& mesh, volVectorField& U, word pName = "p");
// ç¬¬ä¸‰ä¸ªå‚æ•°ç»™äº†é»˜è®¤å€¼

```

- å„ä¸ªå‡½æ•°çš„åŸå‹
- ä¸ºä»€ä¹ˆå¼€å‘åº“çš„å¤´æ–‡ä»¶è¦åŒ…å« `fvCFD.H` ï¼Ÿè¯»è€…å¯ä»¥å°è¯•æ³¨é‡Šæ‰è¿™è¡Œï¼Œé‡æ–°ç¼–è¯‘ï¼Œå¹¶é˜…è¯»æŠ¥é”™ä¿¡æ¯ã€‚è¿™æ ·å¯ä»¥åŠ æ·±å¯¹ `fvCFD.H` æ–‡ä»¶å†…å®¹çš„ç†è§£ã€‚

### æºä»£ç 

æºæ–‡ä»¶ `/userApp/computeVelocityPressure/computeVelocityPressure.C`ï¼Œæˆ‘ä»¬é‡‡ç”¨æ›´â€œOpenFOAMâ€é£æ ¼çš„å®ç°æ–¹å¼ï¼Œå†…å®¹å¦‚ä¸‹

> æ³¨æ„å’Œ [OpenFOAMå¼€å‘ç¼–ç¨‹åŸºç¡€05 åœºçš„åŸºæœ¬æ“ä½œ | ğ“ğ“®ğ“»ğ“¸ğ“¼ğ“ªğ“·ğ“­ (aerosand.cn)](https://aerosand.cn/posts/20230508111149/) æ¯”è¾ƒå„ä¸ªå‡½æ•°çš„å®ç°

```cpp
#include "computeVelocityPressure.H"

scalar computeR(const fvMesh& mesh, volScalarField& r, dimensionedVector x0)
{
    r = mag(mesh.C() - x0); // åœº r ä¿å­˜å„ä¸ªå•å…ƒç½‘æ ¼ä¸­å¿ƒç‚¹å‘é‡åˆ°å‚è€ƒå‘é‡çš„è·ç¦»

    return max(r).value(); // è¿”å›å„ä¸ªè·ç¦»çš„æœ€å¤§å€¼
}

volScalarField computePressure // è®¡ç®—å‹åŠ›åœºï¼Œæ³¨æ„è¿”å›ç±»å‹
(
    const fvMesh& mesh, // ä¼ å…¥ mesh çš„å¼•ç”¨ï¼Œå¼•ç”¨ä¼ é€’æ•ˆç‡é«˜
    scalar t, 
    dimensionedVector x0, // ä¸ä»…æ˜¯ vectorï¼Œè€Œä¸”æ˜¯æœ‰å•ä½åˆ¶çš„ vector
    scalar scale, // çº¯ scalar
    scalar f // çº¯ scalar
)
{
    volScalarField r(mag(mesh.C()-x0)/scale); 
    // ä¸Šä¸€ç¯‡è®¨è®ºä¸­çš„ r åªæ˜¯ scalar ç±»å‹ï¼Œè¿™é‡Œæ˜¯ volScalarField ç±»å‹
    // æ³¨æ„è®¡ç®—ä¸­å˜é‡ç±»å‹çš„ç»Ÿä¸€

    volScalarField rR(1.0/(r+dimensionedScalar("tmp",dimLength,1e-12)));
    // èµ‹äºˆ 1e-12 å•ä½ï¼Œä»¥é€šè¿‡OpenFOAMå¯¹è®¡ç®—çš„å•ä½æ£€æŸ¥
    // æ³¨æ„è®¡ç®—ä¸­ç»“æœå•ä½çš„ç»Ÿä¸€

    return Foam::sin(2.0*Foam::constant::mathematical::pi*f*t)*rR*dimensionedScalar("tmp",pow(dimLength,3)/pow(dimTime,2),1.0);
    // å•ä½å¯ä»¥æŒ‰æ•°å­¦æ–¹å¼è®¡ç®—
    // åŒæ ·ä¸ºäº†ä¿è¯ç»“æœå•ä½ä¸€è‡´ï¼Œé¢å¤–ä¹˜ä»¥å«å•ä½ä¸´æ—¶é‡ tmp
    // è¯¥å‡½æ•°è¿”å›çš„è®¡ç®—ç»“æœçš„å•ä½ï¼Œç­‰äºï¼Œä¸»å‡½æ•°è¦æ¥æ”¶è¯¥å€¼çš„å˜é‡çš„å•ä½
}

void computeVelocity(const fvMesh& mesh, volVectorField& U, word pName)
// æ³¨æ„å‡½æ•°çš„å®ç°ä¸èƒ½å†å†™ä¸Šå½¢å‚çš„é»˜è®¤å€¼
{
    const volScalarField& pField = mesh.lookupObject<volScalarField>(pName);
    // æŒ‰ pName å­—æ®µæŸ¥æ‰¾åœºé‡ï¼Œå¹¶èµ‹å€¼ç»™ pField

    U = fvc::grad(pField) * dimensionedScalar("tmp",dimTime,1.0);
    // è®¡ç®— Uï¼Œä¿è¯å•ä½ç»Ÿä¸€
}

```

> ä¹Ÿè®¸ä¼šæœ‰åŒå­¦å¯¹æ¯”æ•°æ®ç±»å‹æœ‰å›°æƒ‘ï¼Œæ¯”å¦‚ `scalar` ç±»å‹å’Œ `volScalarField` ç±»å‹ã€‚ç®€å•ç†è§£å°±æ˜¯ï¼Œ`scalar` åªæ˜¯ä¸€ä¸ªå€¼ï¼Œè€Œ `volScalarField` æ˜¯ä¸€ç»„æ•°æ®ï¼ŒåŒ…å«äº†è®¡ç®—åŸŸå†…æ‰€æœ‰ç¦»æ•£ç‚¹çš„ `scalar` å€¼ï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤ºäº†ä¸€ä¸ªâ€œåœºâ€ã€‚


### åº“ Make

`/userApp/computeVelocityPressure/Make/files` å†…å®¹å¦‚ä¸‹

```cpp
computeVelocityPressure.C

LIB = $(FOAM_USER_LIBBIN)/libcomputeVelocityPressure

```

- æ³¨æ„ `LIB` å…³é”®å­—çš„å˜åŒ–

`/userApp/computeVelocityPressure/Make/options`

```cpp
EXE_INC = \
    -I$(LIB_SRC)/finiteVolume/lnInclude \
    -I$(LIB_SRC)/meshTools/lnInclude

EXE_LIBS = \
    -lfiniteVolume \
    -lmeshTools

```

- è¯¥åº“ï¼Œå¼ºè°ƒæ˜¯è¿™ä¸ªåº“ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œä¸ä¼šä½¿ç”¨åˆ°å…¶ä»–æ›´å¤šçš„åº“ï¼Œæ‰€ä»¥ `options` ä¸­æœ‰è¿™äº›åŸºç¡€åº“å°±å¤Ÿäº†ï¼Œä¸éœ€è¦ä¿®æ”¹

### ç¼–è¯‘

ç»ˆç«¯ä½¿ç”¨å‘½ä»¤

```
// terminal
wmake computerVelocityPressure/

// wclean computerVelocityPressure/
```

- è¿™ä¸ªåº“ä¹Ÿæ˜¯ç‹¬ç«‹çš„ï¼Œå¯ä»¥è¢«å…¶ä»–ä»»ä½•åº”ç”¨è°ƒç”¨ï¼Œåªè¦å†™å¯¹è°ƒç”¨è·¯å¾„
## createFields.H

åˆ›å»ºåœº `/userApp/createFields.H`ï¼Œå†…å®¹ä¸Šå’Œä¸Šä¸€ç¯‡è®¨è®ºçš„åœºæ–‡ä»¶ç›¸åŒ

```cpp
Info<< "Reading transportProperties\n" << endl;
    IOdictionary transportProperties
    (
        IOobject
        (
            "transportProperties",
            runTime.constant(),
            mesh,
            IOobject::MUST_READ_IF_MODIFIED,
            IOobject::NO_WRITE
        )
    );

    dimensionedScalar nu("nu",dimViscosity,transportProperties);

    Info<< "Reading field p\n" << endl;
    volScalarField p
    (
        IOobject
        (
            "p",
            runTime.timeName(),
            mesh,
            IOobject::MUST_READ,
            IOobject::AUTO_WRITE
        ),
        mesh
    );

    Info<< "Reading field T\n" << endl;
    volScalarField T
    (
        IOobject
        (
            "T",
            runTime.timeName(),
            mesh,
            IOobject::MUST_READ,
            IOobject::AUTO_WRITE
        ),
        mesh
    );

    Info<< "Reading field U\n" << endl;
    volVectorField U
    (
        IOobject
        (
            "U",
            runTime.timeName(),
            mesh,
            IOobject::MUST_READ,
            IOobject::AUTO_WRITE
        ),
        mesh
    );

    volScalarField zeroScalarField
    (
        IOobject
        (
            "zeroScalarField",
            runTime.timeName(),
            mesh,
            IOobject::NO_READ,
            IOobject::AUTO_WRITE
        ),
        mesh,
        dimensionedScalar("zeroScalarField",dimless,Zero)
    );

    volVectorField zeroVectorField
    (
        IOobject
        (
            "zeroVectorField",
            runTime.timeName(),
            mesh,
            IOobject::NO_READ,
            IOobject::AUTO_WRITE
        ),
        mesh,
        dimensionedVector("zeroVectorField",dimless,Zero)
    );

    volVectorField gradT
    (
        IOobject
        (
            "gradT",
            runTime.timeName(),
            mesh,
            IOobject::NO_READ,
            IOobject::AUTO_WRITE
        ),
        fvc::grad(T)
    );

    Info<< "Reading/calculating face flux field phi\n" << endl;
    surfaceScalarField phi
    (
        IOobject
        (
            "phi",
            runTime.timeName(),
            mesh,
            IOobject::READ_IF_PRESENT,
            IOobject::AUTO_WRITE
        ),
        fvc::flux(U)
        // fvc::interpolate(U)*mesh.Sf();
    );

```

## ä¸»æºç 

ä¸»æºç  `/userApp/06_01_devLib.C`ï¼Œå†…å®¹å¦‚ä¸‹

```cpp
#include "fvCFD.H"

#include "computeVelocityPressure.H"

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

int main(int argc, char *argv[])
{
    #include "setRootCase.H"
    #include "createTime.H"

    #include "createMesh.H"

    #include "createFields.H"

    dimensionedVector originVector("x0",dimLength,vector(0.05,0.05,0.005));
    // æ„é€  dimensionedVector ç±»çš„å¯¹è±¡ originVectorï¼Œå¹¶èµ‹å•ä½å’Œåˆå§‹å€¼

    scalar f(1.0);

    volScalarField r // åªæ˜¯è®¡ç®—çš„è¿‡ç¨‹é‡ï¼Œæ‰€ä»¥æ²¡æœ‰æ”¾è¿› createFields.H ä¸­
    (
        IOobject
        (
            runTime.timeName(),
            mesh,
            IOobject::NO_READ,
            IOobject::NO_WRITE
        ),
        mesh,
        dimensionedScalar("r",dimLength,0.0)
    );

    const scalar rFarCell = computeR(mesh,r,originVector);
    // è®¡ç®—å¾—åˆ°è·ç¦»çš„æœ€å¤§å€¼ï¼Œå¹¶ä¼ ç»™ rFarCell å˜é‡ä¿å­˜

    Info<< "\nStarting time loop\n" << endl;

    while (runTime.loop()) // æ—¶é—´æ¨è¿›
    {
        Info<< "Time = " << runTime.timeName() << nl << endl;

        p = computePressure(mesh,runTime.time().value(),originVector,rFarCell,f);
        // è®¡ç®— p åœº

        computeVelocity(mesh,U);
        // è®¡ç®— U åœº

        phi = fvc::flux(U);
        // è®¡ç®— phi åœº

        runTime.write(); // å†™å‡ºåœº
    }

    // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

    Info<< nl;
    runTime.printExecutionTime(Info);

    Info<< "End\n" << endl;

    return 0;
}


// ************************************************************************* //

```

## åº”ç”¨ Make

`/userApp/Make/files` 

```cpp
06_01_devLib.C

EXE = $(FOAM_USER_APPBIN)/06_01_devLib

```

`/userApp/Make/options`

```cpp
EXE_INC = \
    -I$(LIB_SRC)/finiteVolume/lnInclude \
    -I$(LIB_SRC)/meshTools/lnInclude \
    -IcomputeVelocityPressure/lnInclude

EXE_LIBS = \
    -lfiniteVolume \
    -lmeshTools \
    -L$(FOAM_USER_LIBBIN) -lcomputeVelocityPressure

```

- æ³¨æ„å¼€å‘åº“çš„å¤„ç†ï¼Œæ—¢è¦â€œåŒ…å«â€ï¼Œä¹Ÿè¦â€œé“¾æ¥â€ã€‚

## ç¼–è¯‘è¿è¡Œ

```
wmake
./caserun
```

è¿è¡Œç»“æœå¦‚ä¸‹

```
Create time

Create mesh for time = 0

Reading transportProperties

Reading field p

Reading field T

Reading field U

Reading/calculating face flux field phi


Starting time loop

...

ExecutionTime = 0.01 s  ClockTime = 0 s

End
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `paraview` æ‰“å¼€æŸ¥çœ‹è®¡ç®—ç»“æœã€‚

```
// terminal
paraFoam -case debug_case
```

## å°ç»“

ç ”ç©¶ä¸­æ¶‰åŠåˆ°çš„é€šç”¨æ–¹æ³•å¯ä»¥æŠ½è±¡æˆå¼€å‘åº“ï¼Œä½†æ˜¯åˆå­¦è€…ä¸èƒ½è¿½æ±‚æŠŠæ–¹æ³•éƒ½å†™æˆå¼€å‘åº“ï¼Œå…·ä½“é—®é¢˜åº”å½“å…·ä½“å¯¹å¾…ã€‚é€šè¿‡æœ¬ç¯‡è®¨è®ºï¼Œæœ€ä¸»è¦çš„è¿˜æ˜¯ç†Ÿæ‚‰ä»£ç æ¶æ„å’Œä»£ç è¯­æ³•ã€‚

æ­¤å¤–ï¼Œç¼–ç¨‹ä¸­æ³¨æ„å•ä½ç»Ÿä¸€ï¼Œæ³¨æ„æ•°æ®ç±»å‹ç»Ÿä¸€ã€‚