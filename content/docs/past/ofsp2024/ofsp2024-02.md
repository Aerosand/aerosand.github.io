---
uid: 
title: ofsp2024-02
date: 2025-11-04
update: 2025-11-12
authors:
  - name: Aerosand
    link: https://github.com/aerosand
    image: https://github.com/aerosand.png
tags:
  - ofsp
  - ofsp2024
  - OpenFOAM
excludeSearch: false
toc: true
weight: 3
math: true
next:
prev:
comments: true
sidebar:
  exclude: false
draft: false
---

 
> å‚è€ƒï¼š
> - https://github.com/UnnamedMoose/BasicOpenFOAMProgrammingTutorials
> - https://www.topcfd.cn/simulation/solve/openfoam/openfoam-program/
> - https://www.tfd.chalmers.se/~hani/kurser/OS_CFD/
> - https://github.com/ParticulateFlow/OSCCAR-doc/blob/master/openFoamUserManual_PFM.pdf
> - https://www.youtube.com/watch?v=KB9HhggUi_E&ab_channel=UCLOpenFOAMWorkshop
> - http://dyfluid.com/#
> - https://ss1.xrea.com/penguinitis.g1.xrea.com/study/OpenFOAM/index.html
> 
> æ„Ÿè°¢åŸä½œè€…ä»¬çš„æ— ç§å¼•è·¯å’Œå®è´µå·¥ä½œã€‚


> å‰ç½®ï¼š
> [OpenFOAMå¼€å‘ç¼–ç¨‹åŸºç¡€01 è¾“å…¥è¾“å‡º | ğ“ğ“®ğ“»ğ“¸ğ“¼ğ“ªğ“·ğ“­ (aerosand.cn)](https://aerosand.cn/posts/20230507112326/)

OpenFOAM åˆå­¦è€…å¾ˆéš¾ä¸æ³¨æ„åˆ°æ±‚è§£å™¨æ€»æ˜¯æœ‰å‡ ä¸ªå›ºå®šçš„å¤´æ–‡ä»¶ï¼ŒåŒ…æ‹¬ `setRootCase.H` ï¼Œ`createTime.H` å’Œ `createMesh.H` ã€‚ç½‘ç»œä¸Šæ‰¾åˆ°çš„ä»£ç è§£æå¸¸å¸¸åªæœ‰ä¸€å¥æ³¨é‡Šä»‹ç»åŠŸèƒ½ï¼Œä¹Ÿè®¸æ— æ³•æ¶ˆé™¤å›°æƒ‘æ„Ÿã€‚

æœ¬æ–‡åŒæ ·ä» C++ å¼€å§‹ï¼Œç®€å•ä»‹ç»ä¸»å‡½æ•°å‚æ•°ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè®¨è®º `setRootCase.H` å¤´æ–‡ä»¶ã€‚

å»ºç«‹æœ¬æ–‡çš„é¡¹ç›®æ–‡ä»¶å¤¹å¹¶è¿›å…¥

```
// terminal 
cd /home/aerosand/aerosand/ofsp
mkdir 02_args
cd 02_args
```

## C++ å®ç°

### ä¸»å‡½æ•°å‚æ•°

æˆ‘ä»¬åœ¨åˆå­¦ C++ çš„æ—¶å€™ï¼Œä¸»å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸€èˆ¬ç•™ç©ºï¼Œå³æœ‰å¦‚ä¸‹å½¢å¼

```cpp
...
int main() // çœç•¥å‚æ•°åˆ—è¡¨
{
	...
}
```


å½“è¿›ä¸€æ­¥æ·±å…¥ C++ å¼€å‘æ—¶ï¼Œäº†è§£åˆ°ä¸»å‡½æ•°çš„æ›´ä¸€èˆ¬å†™æ³•ä¸º

```cpp
...
int main(int argc, char *argv[]) {}
// æˆ–è€…
int main(int argc, char **argv) {}
```

- `argc` å³ `argument count` çš„ç¼©å†™ï¼Œä¿å­˜ç¨‹åºè¿è¡Œæ—¶ä¼ é€’ç»™ä¸»å‡½æ•°çš„å‚æ•°ä¸ªæ•°
- `argv` å³ `argument vector` çš„ç¼©å†™ï¼Œä¿å­˜ç¨‹åºè¿è¡Œæ—¶ä¼ é€’ç»™ä¸»å‡½æ•°çš„å…·ä½“å‚æ•°çš„å­—ç¬¦å‹æŒ‡é’ˆï¼Œæ¯ä¸ªæŒ‡é’ˆéƒ½æŒ‡å‘ä¸€ä¸ªå…·ä½“çš„å‚æ•°ã€‚
	- `argv[0]` æŒ‡å‘ç¨‹åºè¿è¡Œæ—¶çš„å…¨è·¯å¾„åç§°
	- `argv[1]` æŒ‡å‘ç¨‹åºè¿è¡Œæ—¶å‘½ä»¤è¡Œä¸­æ‰§è¡Œç¨‹åºååç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²
	- `argv[2]` æŒ‡å‘ç¨‹åºè¿è¡Œæ—¶å‘½ä»¤è¡Œä¸­æ‰§è¡Œç¨‹åºååç¬¬äºŒä¸ªå­—ç¬¦ä¸²
	- å…¶ä»–ä»¥æ­¤ç±»æ¨

### é¡¹ç›®å®ç°

æ–°å»ºé¡¹ç›® `02_arg/02_01_args/`

ä¸»æºç  `src/main.cpp` å¦‚ä¸‹æ‰€ç¤º

```cpp
#include <iostream>

int main(int argc, char *argv[])
{
    std::cout << "Number of arguments = " << argc << std::endl;

    for (int i=0; i<argc; ++i)
    {
        std::cout << "Argument " << i << ": "
            << argv[i] << std::endl;
    }

    return 0;
}
```

ç»ˆç«¯ç›´æ¥ç¼–è¯‘è¿è¡Œ

```
// terminal
make run
```

è¿è¡Œç»“æœå¦‚ä¸‹

```
Number of arguments = 1
Argument 0: ./output/main
```

å¦‚æœè¿è¡Œæ—¶å¢åŠ å‚æ•°ï¼Œä¾‹å¦‚

```
// terminal
./output/main hi hey hello
```

è¿è¡Œç»“æœå¦‚ä¸‹

```
Number of arguments = 4
Argument 0: ./output/main
Argument 1: hi
Argument 2: hey
Argument 3: hello
```

åŸºäºä¸»å‡½æ•°å‚æ•°åˆ—è¡¨çš„äº†è§£ï¼Œä¸‹é¢è®¨è®º OpenFOAM ä¸­çš„ä¸»å‡½æ•°å‚æ•°ç­‰å†…å®¹ã€‚

## OpenFOAM å®ç°

### åº”ç”¨å‡†å¤‡

```
// terminal
foamNewApp 02_02_args
cd 02_02_args
cp -r $FOAM_TUTORIALS/incompressible/icoFoam/cavity/cavity debug_case
code .
```

æ–‡ä»¶ç»“æ„å¦‚ä¸‹

```
|- 02_02_args/
	|- debug_case/
		|- 0/
		|- constant/
		|- system/
	|- Make/
		|- files
		|- options
	|- 02_02_args.C
```

ä»¥åéç‰¹åˆ«æƒ…å†µä¸å†èµ˜è¿°æ–‡ä»¶ç»“æ„ã€‚

### è„šæœ¬å’Œè¯´æ˜

æ–°å»ºè„šæœ¬

```
// terminal
code _appmake.sh _appclean.sh _caserun.sh _caseclean.sh README.md
```

è„šæœ¬å†…å®¹å’Œè¯´æ˜æ–‡æ¡£ç•¥ã€‚

### setRootCase.H

å…ˆçœ‹ä¸€ä¸‹ä¸»æºç ä¸­çš„å¤´æ–‡ä»¶ `setRootCase.H` 

```
// termianl
find $FOAM_SRC -iname setRootCase.H
// $FOAM_SRC/OpenFOAM/include/setRootCase.H
```

ä»£ç å…·ä½“ä¸º

```cpp
// Construct from (int argc, char* argv[]),
// - use argList::argsMandatory() to decide on checking command arguments.
// - check validity of the options

Foam::argList args(argc, argv); // æ„é€ argListç±»å‹çš„argså˜é‡
if (!args.checkRootCase()) // å¦‚æœæ£€æŸ¥åº”ç”¨å‚æ•°ï¼ˆç®—ä¾‹è·¯å¾„ï¼‰é”™è¯¯
{
    Foam::FatalError.exit(); // æŠ¥é”™é€€å‡º
}

// User can also perform checks on otherwise optional arguments.
// Eg,
//
//  if (!args.check(true, false))
//  {
//      Foam::FatalError.exit();
//  }

// Force dlOpen of FOAM_DLOPEN_LIBS (principally for Windows applications)
#include "foamDlOpenLibs.H" // å…¼å®¹æ€§å¤„ç†ï¼Œæ— éœ€æ·±ç©¶
```

ä»£ç è®¨è®º
- è¯¥ H æ–‡ä»¶æ£€æŸ¥äº†è¯¥åº”ç”¨çš„å‚æ•°æ˜¯å¦æ­£ç¡®
- æ„é€ å‚æ•°åˆ—è¡¨çš„å¯¹è±¡ `args` ï¼ˆæ‰€ä»¥æ­¤ H æ–‡ä»¶éœ€è¦æ”¾åœ¨æ‰€æœ‰çš„å‚æ•°ä»£ç ç­‰åé¢ï¼‰
- å¦‚æœå‚æ•°åˆ—è¡¨æ£€æŸ¥ä¸é€šè¿‡ï¼Œåˆ™æŠ¥é”™é€€å‡º

 `argList` ç±»æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„ç±»ï¼Œå…·æœ‰å¾ˆå¤šçš„æˆå‘˜æ•°æ®å’Œæˆå‘˜æ–¹æ³•ã€‚æˆ‘ä»¬å¤§æ¦‚æŒ‘å‡ å¤„ä»£ç ä½œä¸ºåˆ‡å…¥ç‚¹ç®€å•äº†è§£ä¸€ä¸‹ `argList` ç±»ã€‚

```
// terminal
find $FOAM_SRC -iname argList.H
// /usr/lib/openfoam/openfoam2306/src/OpenFOAM/global/argList/argList.H
```

æ‰“å¼€ `argList.H` ï¼Œå†…å®¹å¦‚ä¸‹

```cpp
...
class argList
{
	...
public:
	...
	// åŸºäºå‚æ•°çš„æ„é€ å‡½æ•°
	argList
	(
		int& argc, // ä¸»å‡½æ•°å‚æ•°ä¸ªæ•°
		char**& argv, // ä¸»å‡½æ•°å‚æ•°çš„æŒ‡é’ˆ
		bool checkArgs = argList::argsMandatory(),
		bool checkOpts = true,
		bool initialise = true
	);
	...
...
```

æ–¹æ³•çš„å®ç°è¾ƒä¸ºå¤æ‚ï¼Œå¯¹äºç°é˜¶æ®µæ¥è¯´ï¼ŒåŸºç¡€ç±»æ²¡æœ‰å¿…è¦å»æ·±å…¥è®¨è®ºä»£ç çš„å®ç°éƒ¨åˆ†ï¼Œç›®å‰åªéœ€è¦åšåˆ°å¿ƒé‡Œæœ‰æ•°ã€çœ‹åˆ°ä¸é‚£ä¹ˆé™Œç”Ÿå³å¯ã€‚

> åœ¨ä¸Šä¸€ç¯‡æ–‡ç« çš„è®¨è®ºä¸­ï¼Œä¹Ÿå¯ä»¥æ·±å…¥çœ‹ä¸€ä¸‹ OpenFOAM çš„ `IOdictionary` ç±»ï¼Œç»ˆç«¯ä½¿ç”¨å‘½ `find $FOAM_SRC -iname IOdictionary.H`ï¼Œå¯ä»¥æ‰¾åˆ°å¯¹åº”çš„æ„é€ å‡½æ•°åŸå‹ã€‚ä¹Ÿå¯ä»¥æŸ¥æ‰¾åˆ° `IOobject.H` ä¸­çš„æ„é€ å‡½æ•°åŸå‹ã€‚

### ä¸»æºç 

#### å¸®åŠ©ä¿¡æ¯

```cpp
#include "fvCFD.H"

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

int main(int argc, char *argv[])
{
    argList::addNote
    (
        "Demonstrates how to handle command line options.\n\n"
        "Application arguments:\n"
        "----------------------\n"
        "       mathLib - Eigen/GSL/Armodillo/BLAS\n"
        "       level   - computation speedup\n"
    );

    #include "setRootCase.H"
    #include "createTime.H"

    // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

    Info<< nl;
    runTime.printExecutionTime(Info);

    Info<< "End\n" << endl;

    return 0;
}


// ************************************************************************* //

```

ç¼–è¯‘åæŸ¥çœ‹å¸®åŠ©ä¿¡æ¯

```
// terminal
02_02_args -help
```

ç»ˆç«¯è¾“å‡º

```
Usage: 02_02_args [OPTIONS]
Options:
  -case <dir>       Case directory (instead of current directory)
  -decomposeParDict <file>
                    Alternative decomposePar dictionary file
  -parallel         Run in parallel
  -doc              Display documentation in browser
  -help             Display short help and exit
  -help-full        Display full help and exit

Demonstrates how to handle command line options.

Application arguments:
----------------------
       mathLib - Eigen/GSL/Armodillo/BLAS
       level   - computation speedup

Using: OpenFOAM-2306 (2306) - visit www.openfoam.com
Build: _fbf00d6b-20230626
Arch:  LSB;label=32;scalar=64

```

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„å¸®åŠ©ä¿¡æ¯ã€‚

#### åº”ç”¨å‚æ•°

åº”ç”¨å‚æ•°ï¼ˆargumentsï¼‰åœ¨æ‰§è¡Œåº”ç”¨å‘½ä»¤æ—¶æ˜¯å¼ºåˆ¶éœ€è¦çš„ï¼Œä¸‹ä¸€èŠ‚çš„åº”ç”¨é€‰é¡¹ï¼ˆoptionï¼‰æ˜¯å¯é€‰çš„ã€‚

ç»™ä¸»æºç å¢åŠ åº”ç”¨å‚æ•°å¦‚ä¸‹

```cpp
#include "fvCFD.H"

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

int main(int argc, char *argv[])
{
    argList::addNote
    (
        "Demonstrates how to handle command line options.\n\n"
        "Application arguments:\n"
        "----------------------\n"
        "       mathLib - Eigen/GSL/Armodillo/BLAS\n"
        "       level   - computation speedup\n"
    );

    argList::validArgs.append("mathLib");
    argList::validArgs.append("level");
    // å°†åº”ç”¨å‚æ•°å¢è¡¥åˆ°ä¸»å‡½æ•°å‚æ•°åˆ—è¡¨é‡Œ
    // è¿™ä¸¤ä¸ªå‚æ•°æ˜¯å¼ºåˆ¶å¿…é¡»çš„

    #include "setRootCase.H" // æ„é€ OpenFOAMçš„argListç±»å‹çš„argså¯¹è±¡
    #include "createTime.H"

    #include "createMesh.H"

	// argsç¬¬0å‚æ•°æ˜¯ç¨‹åºåæœ¬èº«
    const word args1 = args[1]; // argsç¬¬1å‚æ•°å°±æ˜¯å¢è¡¥çš„ç¬¬1ä¸ªå‚æ•°
    const scalar args2 = args.get<scalar>(2); // å¢è¡¥çš„ç¬¬2ä¸ªå‚æ•°


	// æ˜¾ç¤ºå‚æ•°
    Info<< "Solver setup: " << nl
        << "    use     : " << args1 << nl
        << "    speedup : " << args2 << nl
        << nl << endl;

    // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

    Info<< nl;
    runTime.printExecutionTime(Info);

    Info<< "End\n" << endl;

    return 0;
}


// ************************************************************************* //

```

ç»ˆç«¯è¿è¡Œæ˜¯å¿…é¡»è¦æä¾›ç›¸åº”ç±»å‹çš„å‚æ•°

ç¼–è¯‘åè¿è¡Œ

```
// terminal
blockMesh -case debug_case
02_02_args -case debug_case GSL 2
```

ç»“æœä¸º

```
Create time

Create mesh for time = 0

Solver setup: 
    use     : GSL
    speedup : 2



ExecutionTime = 0 s  ClockTime = 0 s

End

```



#### åº”ç”¨é€‰é¡¹

åº”ç”¨é€‰é¡¹åœ¨è¿è¡Œæ—¶å¯å†™å¯ä¸å†™ã€‚

ä¸»æºç å¦‚ä¸‹

```cpp
#include "fvCFD.H"

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

int main(int argc, char *argv[])
{
    argList::addNote
    (
        "Demonstrates how to handle command line options.\n\n"
        "Application arguments:\n"
        "----------------------\n"
        "       mathLib - Eigen/GSL/Armodillo/BLAS\n"
        "       level   - computation speedup\n"
    );

	// åº”ç”¨å‚æ•°è¦åœ¨ setRootCase.H æ„é€  args ä¹‹å‰
    argList::validArgs.append("mathLib");
    argList::validArgs.append("level");

	// åº”ç”¨é€‰é¡¹ä¹Ÿè¦åœ¨ setRootCase.H æ„é€  args ä¹‹å‰
    argList::addOption
    (
        "dict",
        "word",
        "Use addtional dictionary (just for example)"
    );

    argList::addOption
    (
        "nPrecision",
        "label",
        "Set the precision level (just for example)"
    );

    argList::addBoolOption
    (
        "log",
        "output the log"
    );

	// setRootCase.H å°†æ„é€ argListç±»å‹çš„argså¯¹è±¡
    #include "setRootCase.H"
    #include "createTime.H"

    #include "createMesh.H"

    const word args1 = args[1];
    const scalar args2 = args.get<scalar>(2);

    Info<< "Solver setup: " << nl
        << "    use     : " << args1 << nl
        << "    speedup : " << args2 << nl
        << nl << endl;

	// åˆ›å»º_dictå¹¶ç»™é»˜è®¤åˆå§‹å€¼
    fileName _dict("./system/myDict");
    if (args.found("dict"))
    {
        args.readIfPresent("dict",_dict);
        // å¦‚æœä½¿ç”¨äº† -dict é€‰é¡¹ï¼Œåˆ™ä½¿ç”¨ -dict åçš„å€¼
        // ä¹Ÿè®¸ä¼šæœ‰åŒå­¦ç–‘é—®ä¸Šé¢è¿™å¥ä»£ç ä¸ºä»€ä¹ˆèƒ½è¯»å– -dict åçš„å€¼å¹¶ä¼ ç»™ _dict
        // å»ºè®®å…ˆä¸è¦æ·±ç©¶ï¼Œä»¥åç†Ÿæ‚‰C++äº†å¯ä»¥ç¿»é˜…OpenFOAMæ›´åº•å±‚çš„æºä»£ç 
        Info<< "Reading myDict " << endl;
    }
    Info<< "Dictionary from " << _dict << nl << endl;

	// åˆ›å»º label ç±»å‹çš„å¯¹è±¡å¹¶ç»™é»˜è®¤åˆå§‹å€¼
    label _nPrecision(6);
    args.readIfPresent("nPrecision",_nPrecision);
    Info<< "Precision is " << _nPrecision << endl;

    const bool _log = args.found("log");
    if (_log)
    {
        Info<< "Output the logs" << endl;
    }
    // åªè¦ä½¿ç”¨ -log é€‰é¡¹ï¼Œå°±ä¼šæ‰§è¡Œä¸€äº›æ–¹æ³•ï¼Œæ¯”å¦‚è¿™é‡Œçš„è¾“å‡º


    // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

    Info<< nl;
    runTime.printExecutionTime(Info);

    Info<< "End\n" << endl;

    return 0;
}


// ************************************************************************* //

```

ç¼–è¯‘è¿è¡Œåº”ç”¨

```
// terminal
blockMesh -case debug_case
02_02_args -case debug_case GSL 2 -dict ../constant/myDict -nPrecision 12
```

è¿è¡Œç»“æœä¸º

```
Create time

Create mesh for time = 0

Solver setup: 
    use     : GSL
    speedup : 2


Reading myDict
Dictionary from "../constant/myDict"

Precision is 12


ExecutionTime = 0 s  ClockTime = 0 s

End

```


å¦‚æœè¿è¡Œåº”ç”¨å¦‚ä¸‹

```
02_02_args -case debug_case GSL 2 -dict ../constant/myDict -log
```

è¿è¡Œç»“æœä¸º

```
Create time

Create mesh for time = 0

Solver setup: 
    use     : GSL
    speedup : 2


Reading myDict
Dictionary from "../constant/myDict"

Precision is 0

Output the logs

ExecutionTime = 0.01 s  ClockTime = 0 s

End

```

åº”ç”¨é€‰é¡¹ `-dict` ä¹Ÿæœ‰é»˜è®¤å€¼ï¼Œå¯ä»¥å°è¯•çœç•¥å¹¶è¿è¡Œåº”ç”¨ã€‚

é€šè¿‡ä½¿ç”¨ä¸åŒçš„åº”ç”¨é€‰é¡¹ï¼Œçœ‹åˆ°å„è¡Œæºä»£ç çš„æ•ˆæœã€‚

## å°ç»“

ä» C++ åŸºç¡€å‡ºå‘ï¼Œ ç®€å•è®¨è®ºäº†ä¸»å‡½æ•°è¿è¡Œæ—¶çš„å¸®åŠ©ã€å‚æ•°å’Œé€‰é¡¹ã€‚è™½ç„¶ä¸Šé¢çš„å¼€å‘éƒ½æ˜¯ä»…åœç•™åœ¨è¡¨é¢åšåšæ ·å­ï¼Œä½†ç›®çš„ä¹Ÿæ˜¯ä½¿è¯»è€…å¯¹ OpenFOAM ä¸­è¿è¡Œåº”ç”¨çš„å‘½ä»¤è¡Œæ–¹æ³•æœ‰äº†ä¸€äº›äº†è§£ï¼Œä»¥åä¹Ÿå¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ·±å…¥ã€‚æ›´æ·±å…¥çš„å¼€å‘è§åç»­è®¨è®ºã€‚

æœ¬æ–‡åŸºæœ¬ææ˜ç™½äº† OpenFOAM æ±‚è§£å™¨ä¸­å¿…å¤‡çš„ `setRootCase.H` åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œé‚£ä¹ˆ `createTime.H` å¤´æ–‡ä»¶åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ 
