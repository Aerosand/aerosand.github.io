---
uid: 
title: ofsp2024-01
date: 2025-11-04
update: 2025-11-12
authors:
  - name: Aerosand
    link: https://github.com/aerosand
    image: https://github.com/aerosand.png
tags:
  - ofsp
  - ofsp2024
  - OpenFOAM
excludeSearch: false
toc: true
weight: 2
math: true
next:
prev:
comments: true
sidebar:
  exclude: false
draft: false
---

> å‚è€ƒï¼š
> - https://github.com/UnnamedMoose/BasicOpenFOAMProgrammingTutorials
> - https://www.topcfd.cn/simulation/solve/openfoam/openfoam-program/
> - https://www.tfd.chalmers.se/~hani/kurser/OS_CFD/
> - https://github.com/ParticulateFlow/OSCCAR-doc/blob/master/openFoamUserManual_PFM.pdf
> - https://www.youtube.com/watch?v=KB9HhggUi_E&ab_channel=UCLOpenFOAMWorkshop
> - http://dyfluid.com/#
> - https://ss1.xrea.com/penguinitis.g1.xrea.com/study/OpenFOAM/index.html
> 
> æ„Ÿè°¢åŸä½œè€…ä»¬çš„æ— ç§å¼•è·¯å’Œå®è´µå·¥ä½œã€‚

> å‰ç½®ï¼š
>  [OpenFOAMå¼€å‘ç¼–ç¨‹åŸºç¡€00 åŸºæœ¬å®ç°å’Œå¼€å‘ | ğ“ğ“®ğ“»ğ“¸ğ“¼ğ“ªğ“·ğ“­ (aerosand.cn)](https://aerosand.cn/posts/20230502112308/) 
>  
> è¿™é‡Œéœ€è¦é‡ç”³ OpenFOAM åˆå­¦è€…çš„ C++ å­¦ä¹ çš„ä¸ªäººå»ºè®®ï¼šç›®å‰é˜¶æ®µï¼Œéœ€è¦ç³»ç»Ÿå­¦ä¹  C++ï¼Œéœ€è¦å¯¹ C++ æœ‰åŸºæœ¬å’Œå®Œæ•´çš„è®¤çŸ¥ï¼Œæš‚æ—¶ä¸éœ€è¦æ·±å…¥å­¦ä¹  C++ï¼Œæš‚æ—¶ä¸éœ€è¦å­¦ä¹ ç¼–ç¨‹ç®—æ³•ï¼Œä¸éœ€è¦ç­‰åˆ°å­¦å®Œå†å¼€å§‹ OpenFOAMã€‚éœ€è¦ä¸æ–­å­¦ä¹  C++ï¼Œéœ€è¦æ…¢æ…¢æ·±å…¥å­¦ä¹  C++ï¼Œéœ€è¦åœ¨ä¸æ–­çš„å®è·µä¸­ç§¯ç´¯ C++ ç»éªŒã€‚

åœ¨åšè®¡ç®—æˆ–è€…å…¶ä»–äº¤äº’å·¥ä½œçš„æ—¶å€™ï¼Œä¿¡æ¯æµçš„å†™å…¥å†™å‡ºæ˜¯ä¸å¯é¿å…çš„ã€‚æ¯”å¦‚ä»æ–‡ä»¶ä¸­è¯»å–è®¡ç®—å‚æ•°ã€è¯»å–ææ–™æ€§è´¨ï¼Œåˆæˆ–è€…æ˜¯å‘æ–‡ä»¶å†™å…¥è®¡ç®—åçš„ç‰©ç†åœºã€‚

æ‰€ä»¥ï¼Œåœ¨äº†è§£åº”ç”¨çš„åŸºæœ¬å®ç°å’Œå¼€å‘åï¼Œæˆ‘ä»¬è®¨è®ºä¸€ä¸‹åº”ç”¨çš„è¾“å‡ºè¾“å‡ºæ–¹æ³•ã€‚

> æœ¬æ–‡ä¾ç„¶åŸºäº ubuntu22.04 ç³»ç»Ÿï¼ŒOpenFOAM 2306 ç‰ˆæœ¬ï¼ˆå’Œ 2212 ç‰ˆæœ¬ï¼Œ2206 ç‰ˆæœ¬å‡ ä¹æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ï¼Œä¸ç”¨æ‹…å¿ƒï¼‰ã€‚æ­¤ç³»åˆ—ä»¥åä¸å†èµ˜è¿°ã€‚

å»ºç«‹æœ¬æ–‡çš„é¡¹ç›®æ–‡ä»¶å¤¹å¹¶è¿›å…¥

```
// terminal
cd /home/aerosand/aerosand/ofsp
mkdir 01_IO
cd 01_IO
```

## C++ å®ç°

C++ é€šè¿‡è¾“å…¥è¾“å‡ºæµæ¥å®ç°ä»æ–‡ä»¶ä¸­è¯»å–æˆ–è€…å‘æ–‡ä»¶ä¸­å†™å…¥ã€‚

### æ–‡ä»¶æµ

åœ¨åˆå­¦çš„æ—¶å€™æˆ‘ä»¬å°±çŸ¥é“ C++ æä¾› `iostream` æ ‡å‡†åº“ï¼ŒåŒ…å« `cin` å’Œ `cout` æ–¹æ³•ï¼Œç”¨äºä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ä¿¡æ¯æµï¼Œæˆ–è€…ä»æ ‡å‡†è¾“å‡ºä¸­å†™å…¥ä¿¡æ¯æµã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒC++ è¿˜æä¾› `fstream` æ ‡å‡†åº“ï¼Œç”¨äºå¤–éƒ¨æ–‡ä»¶å’Œä¿¡æ¯æµä¹‹é—´çš„äº¤äº’ã€‚

- `ofstream` è¡¨ç¤ºè¾“å‡ºæ–‡ä»¶æµï¼Œç”¨äºåˆ›å»ºæ–‡ä»¶å¹¶å‘æ–‡ä»¶å†™å…¥ä¿¡æ¯
- `ifstream` è¡¨ç¤ºè¾“å…¥æ–‡ä»¶æµï¼Œç”¨äºä»æ–‡ä»¶è¯»å–ä¿¡æ¯
- `fstream` è¡¨ç¤ºé€šç”¨æ–‡ä»¶æµï¼ŒåŒæ—¶å…·æœ‰å†™å…¥å†™å‡ºçš„æ–¹æ³•

### é¡¹ç›®å®ç°

é€šè¿‡ vscode çš„ `C/C++ Project Generater` åœ¨ `01_IO/` è·¯å¾„ä¸‹æ–°å»ºé¡¹ç›® `01_01_IO/`ã€‚

ä¸»æºç  `src/main.cpp` å¦‚ä¸‹æ‰€ç¤º

```cpp
#include <iostream> // IOæ ‡å‡†åº“
#include <string> // å­—ç¬¦ä¸²åº“
#include <fstream> // æ–‡ä»¶æµåº“
#include <cassert> // å¼‚å¸¸åˆ¤æ–­åº“

int main(int argc, char *argv[])
{
    std::string name;
    int year;
    std::string var[3];

    std::fstream infile; // å®šä¹‰ä¸€ä¸ªæ–‡ä»¶æµ
    infile.open("input.dat",std::fstream::in); // æ‰“å¼€æ–‡ä»¶å¹¶å‡†å¤‡è¯»å–
    if (!infile) { // å¼‚å¸¸åˆ¤æ–­ï¼Œå¦‚æœæ‰“å¼€å¤±è´¥ï¼Œåˆ™æ‰§è¡Œä¸‹é¢
        std::cout << "# WARNING: NO input!" << std::endl;
        assert(infile); // ç»ˆæ­¢ç¨‹åºå¹¶æŠ›å‡ºé”™è¯¯ä¿¡æ¯ï¼ˆé¢‘ç¹è°ƒç”¨å½±å“æ€§èƒ½ï¼‰
    }
    infile >> var[0] >> name;
    infile >> var[1] >> year;
    infile.close(); // å¿…é¡»å…³é—­æ–‡ä»¶

    std::cout << var[0] << "\t\t@\t" << var[1] << std::endl;
    std::cout << name << "\t@\t" << year << std::endl;


    std::fstream outfile;
    outfile.open("output.dat",std::fstream::out); // æ‰“å¼€æ–‡ä»¶å¹¶å‡†å¤‡å†™å…¥
    outfile << var[0] <<"\t" << name << std::endl;
    outfile << var[1] << "\t" << year << std::endl;
    outfile.close(); // å¿…é¡»å…³é—­æ–‡ä»¶

	// ç°ä»£ C++ å¯ä»¥ä¸å†™ return 0;
}

```

ä¸ºäº†ä¿è¯æ–‡ä»¶è¯»å–æ­£å¸¸ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ç›¸åº”çš„ `input.dat` æ–‡ä»¶ï¼Œæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å³å¯ã€‚æ–‡ä»¶å†…å®¹å¦‚ä¸‹

```
arg0    Aerosand
arg1    2023
```

ç»ˆç«¯ç¼–è¯‘å¹¶è¿è¡Œæ­¤é¡¹ç›®

```
// terminal
make run
```

è¿è¡Œç»“æœå¦‚ä¸‹

```
g++ -std=c++17 -Wall -Wextra -g -Iinclude -c -MMD src/main.cpp  -o src/main.o
src/main.cpp: In function â€˜int main(int, char**)â€™:
src/main.cpp:6:14: warning: unused parameter â€˜argcâ€™ [-Wunused-parameter]
    6 | int main(int argc, char *argv[])
      |          ~~~~^~~~
src/main.cpp:6:26: warning: unused parameter â€˜argvâ€™ [-Wunused-parameter]
    6 | int main(int argc, char *argv[])
      |                    ~~~~~~^~~~~~
g++ -std=c++17 -Wall -Wextra -g -Iinclude -o output/main src/main.o  -Llib
Executing all complete!
./output/main
arg0		@	arg1
Aerosand	@	2023
Executing run: all complete!
```

æˆ‘ä»¬æ‰¾åˆ°è¾“å‡ºç»“æœï¼ˆé™¤äº†ç¼–è¯‘è¯­å¥ï¼Œè¿˜æœ‰å…¶ä»–ä¿¡æ¯æé†’æœ‰æœªä½¿ç”¨å˜é‡ï¼Œæˆ‘ä»¬ç¡®å®æ²¡æœ‰ä½¿ç”¨ï¼Œä¸ç”¨åœ¨æ„ï¼Œä»¥åä¸å†èµ˜è¿°ï¼‰ï¼Œ

```
arg0		@	arg1
Aerosand	@	2023
```

åŒæ—¶å‘ç°é¡¹ç›®æ ¹ç›®å½•ä¸‹ç”Ÿæˆäº† `output.dat` æ–‡ä»¶ï¼Œæ‰“å¼€çœ‹åˆ°å…¶ä¸­å†…å®¹ä¸º 

```
arg0	Aerosand
arg1	2023

```

è¯¥é¡¹ç›®æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚

## OpenFOAM å®ç°

OpenFOAM çš„åº”ç”¨ä¸€èˆ¬éœ€è¦ä» case ä¸­è¯»å–å­—å…¸ã€ä»è¾¹ç•Œæ¡ä»¶åº“ä¸­è¯»å–è¾¹ç•Œæ•°æ®ï¼Œå‘ case ä¸­è¾“å‡ºè®¡ç®—ç»“æœç­‰ç­‰ã€‚

OpenFOAM æ˜¯æ€ä¹ˆå®ç°ä»æ–‡ä»¶å¤¹è¯»å–å’Œå†™å…¥çš„å‘¢ï¼ŸOpenFOAM çš„è¯»å–å’Œå†™å…¥æ›´åŠ é«˜çº§ï¼ŒæŒ‰å…³é”®è¯è¿›è¡Œç´¢å¼•æŸ¥æ‰¾çš„æ–¹æ³•ç›´æ¥å°è£…åœ¨äº†ç›¸å…³çš„ç±»ä¸­ï¼Œç›´æ¥ä½¿ç”¨æ–¹æ³•å³å¯ï¼Œæš‚æ—¶ä¸ç”¨æ·±ç©¶åˆ°å®ç°çš„ä»£ç å±‚é¢ã€‚

### åº”ç”¨å‡†å¤‡

```
// terminal
foamNewApp 01_02_IO
cd 01_02_IO
cp -r $FOAM_TUTORIALS/incompressible/icoFoam/cavity/cavity debug_case
code .
```

æ–‡ä»¶ç»“æ„å¦‚ä¸‹

```
|- 01_02_IO/
	|- debug_case/
		|- 0/
		|- constant/
		|- system/
	|- Make/ 
		|- files
		|- options
	|- 01_02_IO.C
```

### è„šæœ¬å’Œè¯´æ˜

æ–°å»ºè„šæœ¬

```
// terminal
code _appmake.sh _appclean.sh _caserun.sh _caseclean.sh README.md
```

`_appmake.sh` è„šæœ¬ä¸»è¦è´Ÿè´£åº”ç”¨çš„ç¼–è¯‘ï¼Œæš‚æ—¶å†™å…¥å¦‚ä¸‹å†…å®¹

```
#!/bin/bash

wmake
```

`_appclean.sh` è„šæœ¬ä¸»è¦è´Ÿè´£åº”ç”¨çš„æ¸…ç†ï¼Œæš‚æ—¶å†™å¦‚ä¸‹å†…å®¹

```
#!/bin/bash

wclean
```

`_caserun.sh` è„šæœ¬ä¸»è¦æ˜¯è´Ÿè´£åº”ç”¨ç¼–è¯‘æˆåŠŸåï¼Œè°ƒè¯•ç®—ä¾‹çš„è¿è¡Œï¼Œæš‚æ—¶å†™å…¥å¦‚ä¸‹å†…å®¹

```
#!/bin/bash

blockMesh -case debug_case | tee debug_case/log.mesh
echo "Meshing done."

01_02_IO -case debug_case | tee debug_case/log.run
```

`_caseclean.sh` è„šæœ¬ä¸»è¦æ˜¯è´Ÿè´£æ¸…ç†åº”ç”¨åˆ°åˆ°ç¼–è¯‘å‰çŠ¶æ€ï¼Œå¦‚æœåº”ç”¨è¦ä¿®æ”¹ï¼Œé‚£ä¹ˆæµ‹è¯•ç®—ä¾‹ä¹Ÿè¦è¿˜åŸåˆ°è¿è¡Œå‰çš„çŠ¶æ€ï¼Œæ‰€ä»¥æš‚æ—¶å†™å…¥å¦‚ä¸‹å†…å®¹

```
#!/bin/bash

wclean
rm -rf debug_case/log.*
foamCleanTutorials debug_case
echo "Cleaning done."
```

`README.md` å†™å…¥éœ€è¦è¯´æ˜çš„å†…å®¹ã€‚

> ä»¥åé™¤éæœ‰ç‰¹åˆ«æƒ…å†µï¼Œä¸å†èµ˜è¿°è„šæœ¬å’Œè¯´æ˜

### ä¸»æºç 

ä¸»æºç å¦‚ä¸‹

```cpp
#include "fvCFD.H"

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

int main(int argc, char *argv[])
{
    #include "setRootCase.H"
    #include "createTime.H"

    #include "createMesh.H"


    /* 
    * Reading from the dictionary
    */
    const word dictName("customProperties"); // åˆ›å»ºwordç±»å‹å˜é‡ä¿å­˜å­—å…¸åç§°
    IOobject dictIO // åˆ›å»ºIOobjectç±»å‹å˜é‡ï¼Œä»å‚æ•°åˆ—è¡¨åˆå§‹åŒ–
    (
        dictName, // å­—å…¸åç§°
        runTime.constant(), // å­—å…¸ä½ç½®
        mesh, // å’Œmeshç›¸å…³
        IOobject::MUST_READ, // å¿…é¡»ä»å­—å…¸è¯»å–
        IOobject::NO_WRITE // ä¸å‘å­—å…¸å†™å…¥
    );

    if (!dictIO.typeHeaderOk<dictionary>(true))
    {
        FatalErrorIn(args.executable()) << "Cannot open specified dictionary"
            << dictName << exit(FatalError);
    }
    // å¦‚æœå­—å…¸æ–‡ä»¶åœ¨æ–‡ä»¶å¤´ä¸­æŒ‡å®šçš„ä¸æ˜¯ dictionary ç±»å‹ï¼Œåˆ™æŠ¥é”™

    dictionary myDictionary;
    myDictionary = IOdictionary(dictIO);
    // ä»IOobjectå˜é‡ä¸­åˆ›å»ºå­—å…¸å¯¹è±¡

    // ä¸€èˆ¬ä½¿ç”¨ä¸‹é¢è¿™ç§ç´§å‡‘å†™æ³•
    Info<< "Reading myProperties\n" << endl; 
    IOdictionary myProperties // å­—å…¸å˜é‡åå’Œå­—å…¸æ–‡ä»¶åå–ç›¸åŒ
    (
        IOobject
        (
            "myProperties",
            runTime.constant(),
            mesh,
            IOobject::MUST_READ,
            IOobject::NO_WRITE
        )
    );

    word solver; // åˆ›å»ºwordç±»å‹å˜é‡
    myProperties.lookup("application") >> solver;
    // ä»myPropertiesæ–‡ä»¶ä¸­æŸ¥æ‰¾åˆ°å…³é”®è¯ï¼Œå¹¶å–å€¼èµ‹ç»™solver

    word format(myProperties.lookup("writeFormat"));
    // æˆ–è€…å†™æˆæ›´ç´§å‡‘çš„å½¢å¼

    scalar timeStep(myProperties.lookupOrDefault("deltaT", scalar(0.01)));
    // ä¹Ÿå¯ä»¥å†™æˆ
    // scalar timeStep(myProperties.lookupOrDefault<scalar>("deltaT", 0.01));
    // å¦‚æœå­—å…¸ä¸­æ²¡æœ‰æä¾›è¿™ä¸€å…³é”®è¯ï¼Œåˆ™ä½¿ç”¨æ­¤å¥æä¾›çš„é»˜è®¤å€¼

    bool ifPurgeWrite(myProperties.lookupOrDefault<Switch>("purgeWrite",0));
    // boolç±»å‹ä¹Ÿå¯ä»¥æŒ‰å…³é”®è¯æŸ¥æ‰¾å¹¶è¯»å–

    List<scalar> pointList(myProperties.lookup("point"));
    // åˆ—è¡¨ä¹Ÿå¯ä»¥è¯»å–

    HashTable<vector,word> sourceField(myProperties.lookup("source"));
    // å“ˆå¸Œè¡¨ä¹Ÿå¯ä»¥è¯»å–

	vector myVec = vector(myProperties.subDict("subDict").lookup("myVec"));
	// ä¹Ÿå¯ä»¥åœ¨å­—å…¸æ–‡ä»¶ä¸­å†ä½¿ç”¨å­å­—å…¸
	// æ³¨æ„åæ–‡å­—å…¸æ–‡ä»¶ä¸­çš„å­å­—å…¸å†™æ³•

	// è¾“å‡ºè¯»å–çš„å†…å®¹
    Info<< nl
        << "application: " << solver << nl << nl
        << "writeFormat: " << format << nl << nl
        << "deltaT: " << timeStep << nl << nl
        << "purgeWrite: " << ifPurgeWrite << nl << nl
        << "point: " << pointList << nl << nl
        << "source: " << sourceField << nl << nl
	    << "myVec: " << myVec << nl << nl
        << endl;


    /* 
    * Writing to files
    */
    fileName outputDir = runTime.path()/"processing"; // åˆ›å»ºoutputDirå˜é‡å¹¶èµ‹å€¼è·¯å¾„
    mkDir(outputDir); // åˆ›å»ºä¸Šå¥è·¯å¾„çš„æ–‡ä»¶å¤¹

    autoPtr<OFstream> outputFilePtr; // è¾“å‡ºæ–‡ä»¶æµçš„æŒ‡é’ˆ
    outputFilePtr.reset(new OFstream(outputDir/"myOutPut.dat")); // ç»™æŒ‡é’ˆå®šå‘

	// é€šè¿‡æŒ‡é’ˆç»™è¾“å‡ºæ–‡ä»¶å†™å…¥ä¿¡æ¯
    outputFilePtr() << "processing/myOutPut.dat" << endl;
    outputFilePtr() << "0 1 2 3 ..." << endl;
    sourceField.insert("U3", vector(1, 0.0, 0.0));
    outputFilePtr() << sourceField << endl;

    // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

    Info<< nl;
    runTime.printExecutionTime(Info);

    Info<< "End\n" << endl;

    return 0;
}


// ************************************************************************* //

```

### å­—å…¸æ–‡ä»¶

æä¾›å­—å…¸æ–‡ä»¶ `debug_case/constant/customProperties`ï¼Œè¯¥å­—å…¸æ²¡æœ‰è¯»å–å†™å…¥æ“ä½œï¼Œåªéœ€è¦å†™ä¸Šæ­£ç¡®çš„æ–‡ä»¶å¤´ï¼Œå†…å®¹ç•™ç©ºå¤„ç†ã€‚

```cpp
FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    location    "constant";
    object      customProperties;
}

```

å­—å…¸æ–‡ä»¶ `debug_case/constant/myProperties` ï¼Œå†…å®¹å¦‚ä¸‹

```cpp
FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    location    "constant";
    object      myProperties;
}

application     icoFoam;

writeFormat     ascii;

purgeWrite      1;

point
(
    0
    1
    2
);

source
(
    U1 (0 0 0)
    U2 (1 0 0)
);

subDict
{
    myVec (0.0 0.0 1.0);
}

```

### ç¼–è¯‘è¿è¡Œ

ç»ˆç«¯è¿è¡Œ

```
// terminal
sh _appmake.sh
sh _caserun.sh
```

> ä»¥åä¸å†èµ˜è¿°ç®€å•çš„æ‰§è¡Œå‘½ä»¤

ç»ˆç«¯æ˜¾ç¤ºç»“æœå¦‚ä¸‹

```
// terminal

Create time

Create mesh for time = 0

Reading myProperties


application: icoFoam

writeFormat: ascii

deltaT: 0.01

purgeWrite: 1

point: 3(0 1 2)

source: 
2
(
U1 (0 0 0)
U2 (1 0 0)
)

myVec: (0 0 1)


ExecutionTime = 0.01 s  ClockTime = 0 s

End

```

å¦å¤–ç®—ä¾‹æ–‡ä»¶å¤¹ä¸‹æœ‰äº†ä¸€ä¸ªæ–°å»ºæ–‡ä»¶å¤¹ `debug_case/processing/`ï¼Œè·¯å¾„ä¸‹çš„ `myOutPut.dat` å†…å®¹å¦‚ä¸‹

```cpp
processing/myOutPut.dat
0 1 2 3 ...

3
(
U1 (0 0 0)
U3 (1 0 0)
U2 (1 0 0)
)

```

## å°ç»“

æˆ‘ä»¬åŒæ ·ä»æœ€ä¸€èˆ¬çš„ C++ åŸºç¡€æƒ…å†µåˆ‡å…¥ï¼Œäº†è§£äº†åŸºäºæ–‡ä»¶æµçš„è¾“å…¥è¾“å‡ºï¼Œä¹Ÿè®¨è®ºäº† OpenFOAM è®¾è®¡çš„æ–‡ä»¶æµè¾“å…¥è¾“å‡ºæ–¹æ³•ï¼Œä»¥åä¼šä¸æ–­åœ°ä½¿ç”¨æ–‡ä»¶æµè¾“å…¥è¾“å‡ºã€‚