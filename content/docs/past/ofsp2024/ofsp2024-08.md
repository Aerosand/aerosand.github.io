---
uid: 
title: ofsp2024-08
date: 2025-11-04
update: 2025-11-12
authors:
  - name: Aerosand
    link: https://github.com/aerosand
    image: https://github.com/aerosand.png
tags:
  - ofsp
  - ofsp2024
  - OpenFOAM
excludeSearch: false
toc: true
weight: 9
math: true
next:
prev:
comments: true
sidebar:
  exclude: false
draft: false
---

> å‚è€ƒï¼š
> - https://github.com/UnnamedMoose/BasicOpenFOAMProgrammingTutorials
> - https://www.topcfd.cn/simulation/solve/openfoam/openfoam-program/
> - https://www.tfd.chalmers.se/~hani/kurser/OS_CFD/
> - https://github.com/ParticulateFlow/OSCCAR-doc/blob/master/openFoamUserManual_PFM.pdf
> - https://www.youtube.com/watch?v=KB9HhggUi_E&ab_channel=UCLOpenFOAMWorkshop
> - http://dyfluid.com/#
> - https://ss1.xrea.com/penguinitis.g1.xrea.com/study/OpenFOAM/index.html
> 
> æ„Ÿè°¢åŸä½œè€…ä»¬çš„æ— ç§å¼•è·¯å’Œå®è´µå·¥ä½œã€‚


> å‰ç½®ï¼š
> [OpenFOAMå¼€å‘ç¼–ç¨‹åŸºç¡€07 ç¬¬ä¸€ä¸ªæ±‚è§£å™¨ | ğ“ğ“®ğ“»ğ“¸ğ“¼ğ“ªğ“·ğ“­ (aerosand.cn)](https://aerosand.cn/posts/20230509171012/)

è®¡ç®—æµä½“åŠ›å­¦çš„é€šç”¨åŸºæœ¬æ–¹ç¨‹ä¸º

$$\frac{\partial}{\partial t}(\rho \phi) + \nabla \cdot (\rho U\phi) = \nabla\cdot(\Gamma\nabla\phi) + S_{\phi}$$

æ±‚è§£çš„æ³¢åŠ¨æ–¹ç¨‹å¦‚ä¸‹

$$\frac{\partial^2 A}{\partial t^2} = \nabla \cdot (c^2 \nabla A)$$

æˆ‘ä»¬ä¾ç„¶ç”¨ `A` è¡¨ç¤ºå¾…æ±‚çš„ç‰©ç†åœºã€‚

æ–°å»ºæœ¬æ–‡çš„é¡¹ç›®æ–‡ä»¶å¤¹

```
// terminal
ofsp
mkdir 08_waveSol
cd 08_waveSol
```
##  åº”ç”¨å‡†å¤‡

```
// terminal
foamNewApp 08_01_waveSol
cd 08_01_waveSol
cp /home/aerosand{caserun,caseclean} .
cp -r $FOAM_TUTORIALS/incompressible/icoFoam/cavity/cavity .
cp -r debug_case/0 debug_case/0_orig
code .
```

## è„šæœ¬å’Œè¯´æ˜

ç•¥ã€‚

## æ±‚è§£å™¨

### createFields.H

åœºæ–‡ä»¶ `/userApp/createFields.H` æ¥å…¥ æ–¹ç¨‹æ‰€éœ€è¦çš„åœº `A` å’Œå‚æ•° `c`ã€‚

ä»¥ååœ¨å¼€å‘å¤§å‹æ±‚è§£å™¨çš„æ—¶å€™ï¼Œ`createFields.H` æ–‡ä»¶ä¼šæœ‰ç›¸å½“å¤šè¡Œä»£ç ï¼Œåˆ›å»ºçš„åœºçš„åŠŸèƒ½å„ä¸ç›¸åŒï¼Œè¯»å–çš„å­—å…¸å‚æ•°çš„åŠŸèƒ½ä¹Ÿæ˜¯å„ä¸ç›¸åŒã€‚å»ºè®®å¯ä»¥åœ¨æ–‡ä»¶å¼€å¤´å†™ä¸€ä¸ªç®€å•çš„â€œç›®å½•â€ã€‚è¿™æ ·å­å¯ä»¥é€šè¿‡æœç´¢ç›´è¾¾å†…å®¹åˆ†åŒºã€‚

```cpp
/*
* Contents
*   # Basic fields
*   # Transport properties
*/


/*
* # Basic fields
*/

Info<< "Reading field A\n" << endl;
volScalarField A
(
    IOobject
    (
        "A",
        runTime.timeName(),
        mesh,
        IOobject::MUST_READ,
        IOobject::AUTO_WRITE
    ),
    mesh
);


/*
* # Transport properties
*/

Info<< "Reading transportProperties\n" << endl;
IOdictionary transportProperties
(
    IOobject
    (
        "transportProperties",
        runTime.constant(),
        mesh,
        IOobject::MUST_READ,
        IOobject::NO_WRITE
    )
);

Info<< "Reading c from transportProperties" << endl;
dimensionedScalar c("c",dimViscosity,transportProperties);

```

### ä¸»æºç 

æ–‡ä»¶ `/userApp/08_01_waveSol.C` å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯æ„å»ºä¸€ä¸ªæ—¶é—´æ¨è¿›ï¼Œè¿­ä»£å†…ï¼Œæ¯ä¸ªæ—¶é—´æ­¥æ±‚è§£æ–¹ç¨‹å³å¯ã€‚

```cpp
#include "fvCFD.H"

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

int main(int argc, char *argv[])
{
    argList::addNote(
        "This application solves the wave equation over given mesh."
    );

    #include "setRootCase.H"
    #include "createTime.H"

    #include "createMesh.H"

    #include "createFields.H"

    Info<< nl << "Starting time loop..." << endl;

    while (runTime.loop())
    {
        Info<< nl << "Time = " << runTime.timeName() << endl;

        Info<< "Solving h field" << endl;

        fvScalarMatrix hEqn
        (
            fvm::d2dt2(h)
            == fvm::laplacian(sqr(C), h)
        );

        hEqn.solve();

        runTime.write();

        Info<< nl;
        runTime.printExecutionTime(Info);

    }

    // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //


    Info<< "End\n" << endl;

    return 0;
}
```

### ç¼–è¯‘

```
// termianl
wclean
wmake
```

## è°ƒè¯•ç®—ä¾‹

- `system/blockMeshDict` æ— éœ€ä¿®æ”¹ï¼Œæˆ‘ä»¬ä»ç„¶ä½¿ç”¨åŸå‡ ä½•æ¨¡å‹å’Œå‡ ä½•ç½‘æ ¼
- `system/controlDict` æ— éœ€ä¿®æ”¹ï¼Œæˆ‘ä»¬ä»ç„¶ä½¿ç”¨æ±‚è§£æ§åˆ¶çš„è®¾ç½®ï¼ˆæ­¥é•¿æ­¥æ•°ç­‰ï¼‰
- `decomposedParDict` å’Œ `PDRblockMeshDict` ä¸ç”¨ç®¡ï¼Œæœ¬æ–‡ç”¨ä¸åˆ°
### transportProperties

æ–‡ä»¶ `debug_case/constant/transportProperties` å†…å®¹ä¿®æ”¹å¦‚ä¸‹

```cpp
C              0.05;
```

### åˆå§‹æ¡ä»¶

åŸºäºåˆå§‹æ¡ä»¶ `p` ä¿®æ”¹å¾—åˆ° `A` ï¼Œå†…å®¹å¦‚ä¸‹

```cpp
FoamFile
{
    version     2.0;
    format      ascii;
    arch        "LSB;label=32;scalar=64";
    class       volScalarField;
    location    "0";
    object      A;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

dimensions      [0 1 0 0 0 0 0];

internalField   uniform 0;

boundaryField
{
    movingWall
    {
        type            fixedValue;
        value           uniform 0;
    }
    fixedWalls
    {
        type            fixedValue;
        value           uniform 0;
    }
    frontAndBack
    {
        type            empty;
    }
}


// ************************************************************************* //

```

### setFieldsDict

ä½¿ç”¨å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¨¡æ¿åˆ°è°ƒè¯•ç®—ä¾‹ä¸‹

```
// terminal
foamGetDict -case debug_case setFieldsDict
```

ä¿®æ”¹æ–‡ä»¶ `/debug_case/system/setFieldsDict` ï¼Œå†…å®¹å¦‚ä¸‹

```cpp
FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      setFieldsDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

defaultFieldValues
(
    volScalarFieldValue A 0
);

regions
(
    // Set cell values
    // (does zerogradient on boundaries)
    boxToCell
    {
        box (0.04 0.04 0) (0.06 0.06 0.01);

        fieldValues
        (
            volScalarFieldValue A 1
        );
    }
);

// ************************************************************************* //

```

- æ³¨æ„è°ƒè¯•ç®—ä¾‹çš„ `blockMeshDict` ä¸­è®¾ç½®äº† `scalar 0.1;` ï¼Œå‡ ä½•å°ºå¯¸æœ‰äº†ç¼©æ”¾ï¼Œæ‰€ä»¥åœ¨è®¾ç½® `box` çš„æ—¶å€™è¦æ³¨æ„åæ ‡ç‚¹
- è®¾ç½® `boxToCell` ä¸­ `box` çš„ä¸¤ä¸ªè§’ç‚¹åæ ‡
- æ³¨æ„ï¼Œ`setFields` åªé‡è®¾äº†åˆå§‹åœºï¼ŒåŒºåˆ«äºåœºé‡Œçš„ `æº` ã€‚

### fvSchemes

å¢åŠ æ—¶é—´é¡¹äºŒé˜¶åå¯¼çš„æ•°å€¼è®¡ç®—ç¦»æ•£æ ¼å¼ï¼Œå…¶ä»–ä¸å˜

```cpp
...
d2dt2Schemes
{
    default         Euler;
}
```

### fvSolution

```cpp
FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      fvSolution;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

solvers
{
    A
    {
        solver          PCG;
        preconditioner  DIC;
        tolerance       1e-06;
        relTol          0.05;
    }

    AFinal
    {
        $p;
        relTol          0;
    }
}

// ************************************************************************* //

```

>  ä¹Ÿå¯ä»¥å†™æˆ `A|AFinal` ï¼Œç„¶åä¸€èµ·è®¾ç½®

### controlDict

éšæ„è®¾ç½®è®¡ç®—æ—¶é—´é•¿çŸ­ç­‰ã€‚

### è„šæœ¬

å› ä¸ºé¢å¤–ä½¿ç”¨äº† `setFields` å‘½ä»¤ï¼Œä¸”è¯¥å‘½ä»¤ä¼šæ›´æ”¹åˆå§‹æ¡ä»¶ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹è„šæœ¬ã€‚

`caserun` å†…å®¹å¦‚ä¸‹

```bash
#!/bin/sh
cd "${0%/*}" || exit 1                              # Run from this directory
#------------------------------------------------------------------------------

appPath=$(cd `dirname $0`; pwd)                     # Get application path
appName="${appPath##*/}"                            # Get application name

# cd debug_case

# echo $appName

blockMesh -case debug_case | tee debug_case/log.mesh
echo "Meshing done."

cp -r debug_case/0_orig/ debug_case/0/
setFields -case debug_case
echo "Setting fileds done."

$appName -case debug_case | tee debug_case/log.run

```

`caseclean` å†…å®¹å¦‚ä¸‹

```bash
#!/bin/sh
cd "${0%/*}" || exit 1                              # Run from this directory
#------------------------------------------------------------------------------

appPath=$(cd `dirname $0`; pwd)
appName="${casePath##*/}"

cd debug_case

rm -rf log.*
foamCleanTutorials
rm -rf 0/
echo "Cleaning done."

```
### è®¡ç®—

```
// terminal
./caseclean
./caserun

paraFoam -case debug_case
```

ä½¿ç”¨ `paraview` å¯ä»¥çœ‹åˆ°ä¸­å¿ƒç‚¹åœºéšç€æ—¶é—´çš„æ³¢åŠ¨å˜åŒ–ã€‚


## å°ç»“

æœ¬æ–‡è®¨è®ºæ±‚è§£äº†ä¸€ä¸ªéå®šå¸¸æ³¢åŠ¨é—®é¢˜ã€‚æˆ‘ä»¬é€šè¿‡æ³¨é‡Šå’Œä»£ç æ‹†å‡ºï¼Œå°è¯•æŠŠæ±‚è§£å™¨ç»“æ„å†™çš„æ›´åŠ æ¸…æ™°æ˜“è¯»ã€‚é¦–æ¬¡ä½¿ç”¨äº† OpenFOAM è‡ªå¸¦çš„å·¥å…· `setFields` ï¼ˆæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ `åº”ç”¨`ï¼‰ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºå¾…æ±‚çš„æ³¢åŠ¨æ–¹ç¨‹ç®€å•ï¼Œæ‰€ä»¥æœ¬æ–‡æ±‚è§£å™¨å¯¹åå¾®åˆ†æ–¹ç¨‹çš„æ±‚è§£å¹¶æ²¡æœ‰ä½¿ç”¨ä»»ä½•çš„ç®—æ³•ï¼Œåªæ˜¯ç®€å•çš„åœ¨æ¯ä¸ªæ—¶é—´æ­¥æ±‚è§£ã€‚å®é™…å¼€å‘ä¸­ï¼Œæ›´å¤šçš„é—®é¢˜æ˜¯å¤šä¸ªç‰©ç†åœºè€¦åˆï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€äº›æ•°å€¼ç®—æ³•æ¥æ±‚è§£åå¾®åˆ†æ–¹ç¨‹ç»„ï¼Œè€Œä¸æ˜¯å•ä¸ªåå¾®åˆ†æ–¹ç¨‹ã€‚

è™½ç„¶æœ¬ç³»åˆ—æ˜¯å¼€å‘ç¼–ç¨‹ç³»åˆ—ï¼Œä½†æ˜¯åœ¨æ­£å¼è¿›å…¥ OpenFOAM æ ‡å‡†æ±‚è§£å™¨å¼€å‘å‰ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€æ¬¡è®¨è®ºä¸­ä¸å¾—ä¸è®²ä¸€ä¸‹ OpenFOAM çš„åŸºç¡€æ±‚è§£ç®—æ³•ï¼Œä¸»è¦æ˜¯ `SIMPLE, PISO, PIMPLE` ã€‚

è™½ç„¶ç³»åˆ—è®¨è®ºè¿½æ±‚ç»™åˆå­¦è€…å¸¦æ¥â€œè¿ç»­â€â€œé€æ·±â€â€œæœ‰æ–¹å‘â€â€œä¸é—´æ–­â€çš„å­¦ä¹ ä½“éªŒï¼Œä½†è¿™æ˜¯é¿ä¸å¼€çš„ä¸€ç¯ã€‚