---
title: ofsp2024-03 æ—¶é—´ç±»åˆæ­¥
date: 2023-05-07-Sunday 17:52:11
updated: 2025-06-18-Wednesday 16:44:35
abbrlink: 20230507175211
tags: [OpenFOAM, OFprogramming, ofsp2024]
categories: [OpenFOAM]
keywords: 
description: åˆæ­¥è®¤è¯†æ—¶é—´ç±»ç›¸å…³ä»£ç å’Œæ–¹æ³•
top_img: 0img/openfoam.png
cover: 0img/openfoam.png
comments: true
toc: true
toc_number: true
toc_style_simple: false
copyright: true
copyright_author: Aerosand
copyright_author_href: https://aerosand.cn
copyright_url: https://aerosand.cn
copyright_info: æ­¤æ–‡ç« ç‰ˆæƒå½’aerosand.cnæ‰€æœ‰ï¼Œå¦‚æœ‰è½¬è½½ï¼Œè¯·æ³¨æ˜æ¥è‡ªåŸä½œè€…
mathjax: true
katex: true
highlight_shrink: false
aside: true
swiper_index: 
sticky:
---

> å‚è€ƒï¼š
> - https://github.com/UnnamedMoose/BasicOpenFOAMProgrammingTutorials
> - https://www.topcfd.cn/simulation/solve/openfoam/openfoam-program/
> - https://www.tfd.chalmers.se/~hani/kurser/OS_CFD/
> - https://github.com/ParticulateFlow/OSCCAR-doc/blob/master/openFoamUserManual_PFM.pdf
> - https://www.youtube.com/watch?v=KB9HhggUi_E&ab_channel=UCLOpenFOAMWorkshop
> - http://dyfluid.com/#
> - https://ss1.xrea.com/penguinitis.g1.xrea.com/study/OpenFOAM/index.html
> - https://marketplace.visualstudio.com/items?itemName=ZhuoYang.ofextension
> 
> æ„Ÿè°¢åŸä½œè€…ä»¬çš„æ— ç§å¼•è·¯å’Œå®è´µå·¥ä½œã€‚


> å‰ç½®ï¼š
> [OpenFOAMå¼€å‘ç¼–ç¨‹åŸºç¡€02 ä¸»å‡½æ•°å‚æ•°åˆ—è¡¨ç±»åˆæ­¥ | ğ“ğ“®ğ“»ğ“¸ğ“¼ğ“ªğ“·ğ“­ (aerosand.cn)](https://aerosand.cn/posts/20230507155349/)

æœ¬æ–‡ç®€å•ä»‹ç» OpenFOAM ä¸­çš„ Time ç±»ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè®¨è®ºäº† `createTime.H` å¤´æ–‡ä»¶ã€‚

å»ºç«‹æœ¬æ–‡çš„é¡¹ç›®æ–‡ä»¶å¤¹å¹¶è¿›å…¥

```
// terminal 
cd /home/aerosand/aerosand/ofsp
mkdir 03_time
cd 03_time
```

## OFextension æ’ä»¶ä½¿ç”¨

ååˆ†æ¨èåœ¨ vscode ä¸­å®‰è£…ç¤¾åŒºæ’ä»¶ `OFextension`

> å‚è€ƒ [OpenFOAMåœ¨VS Codeä¸‹çš„debugæ¨¡å¼è°ƒè¯• - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/616488177#:~:text=%E7%94%A8VS%20Code%E6%89%93%E5%BC%80%E8%AF%A5%E6%B1%82%E8%A7%A3%E5%99%A8%20code.,%E8%AE%BE%E7%BD%AE%E6%8F%92%E4%BB%B6OFextension%EF%BC%8C%E8%BE%93%E5%85%A5openfoam%E5%AE%89%E8%A3%85%E8%B7%AF%E5%BE%84%20%E6%8C%89F1%E6%89%93%E5%BC%80%E5%B9%B6%E8%BE%93%E5%85%A5ofInit%EF%BC%8C%E5%9B%9E%E8%BD%A6%E4%BC%9A%E5%87%BA%E7%8E%B0debug%E8%B7%AF%E5%BE%84%EF%BC%8C%E9%BB%98%E8%AE%A4%E5%9B%9E%E8%BD%A6%E3%80%82%20%E9%9A%8F%E5%90%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B0%86%E6%9B%B4%E6%94%B9%20%E6%B7%BB%E5%8A%A0%E6%96%AD%E7%82%B9%EF%BC%8C%E7%82%B9%E5%87%BBdebug%E5%8F%AF%E4%BB%A5%E5%BC%80%E5%A7%8B%E8%B0%83%E8%AF%95)

### é…ç½®æ’ä»¶

1. `Ofextension: OFpath` è®¾ç½®æ­£ç¡®çš„ OpenFOAM å®‰è£…è·¯å¾„
2. ä½¿ç”¨ vscode æ‰“å¼€ç”¨æˆ·çš„å¼€å‘åº”ç”¨ï¼Œä½¿ç”¨ `F1` è¾“å…¥ `ofInit` åˆå§‹åŒ–é…ç½®

### ä»£ç ç¼–å†™

åœ¨åº”ç”¨å¼€å‘ä¸­ï¼Œä¾‹å¦‚æœ¬æ–‡åº”ç”¨ï¼Œåœ¨ä¸»æºç ä¸­è¾“å…¥ `runTime.` ï¼Œvscode ä¼šè‡ªåŠ¨å¼¹å‡ºå¯é€‰çš„ `runTime` æ–¹æ³•ï¼ˆæˆå‘˜å‡½æ•°ï¼‰ã€‚

è€Œä¸”å¯ä»¥åœ¨ä¸»æºç ä¸­é€‰ä¸­å¤´æ–‡ä»¶ã€ç±»ç­‰ï¼Œå³é”®ä½¿ç”¨ `Go to Definition` ï¼Œ`Go to Declaration` ç­‰ï¼Œç›´æ¥è·³è½¬æŸ¥çœ‹æºä»£ç ã€‚

éå¸¸æ¨èæ­¤æ’ä»¶ï¼Œååˆ†æ–¹ä¾¿ã€‚æ³¨æ„ä¸è¦åœ¨ OpenFOAM æºæ–‡ä»¶å¤¹ä¸‹åˆå§‹åŒ–ã€‚

### ç¨‹åºè°ƒè¯•

1. è°ƒè¯•ç®—ä¾‹çš„æ–‡ä»¶å¤¹åç§°ä¿æŒä¸º `debug_case`
2. `userApp/Make/options` ä¸­çš„ `EXE_INC = ` ä¸‹çš„ç¬¬ä¸€è¡Œéœ€è¦æ·»åŠ  `-g \` è°ƒè¯•å‚æ•°
3. æ‰§è¡Œ `ofInit` åˆå§‹åŒ–é…ç½®
4. ç»™ä»£ç è¡Œæ‰“ç‚¹ï¼Œè¿›å…¥ vscode è°ƒè¯•ç•Œé¢è¿›è¡Œè°ƒè¯•

## æ—¶é—´ç±»æ–¹æ³•

### åº”ç”¨å‡†å¤‡

```
// terminal
foamNewApp 03_01_time
cd 03_01_time
cp -r $FOAM_TUTORIALS/incompressible/icoFoam/cavity/cavity debug_case
code .
```

### è„šæœ¬å’Œè¯´æ˜

è¯»è€…å¯èƒ½æ„Ÿå—åˆ°å‰å‡ ç¯‡æ–‡ç« ä½¿ç”¨çš„è„šæœ¬å¯¹æ¯ä¸ªä¸åŒçš„åº”ç”¨éƒ½è¦é‡æ–°å†™ï¼Œååˆ†ç¹çã€‚

æˆ‘ä»¬é€æ¸ä»‹ç»ä¸€äº›æ›´æ–¹ä¾¿çš„è„šæœ¬å†™æ³•ã€‚

æ–°å»ºè„šæœ¬

```
// terminal
code caserun caseclean
```

`caserun` è„šæœ¬è´Ÿè´£åº”ç”¨ç¼–è¯‘æˆåŠŸåï¼Œè°ƒè¯•ç®—ä¾‹çš„è¿è¡Œï¼Œå†…å®¹å¦‚ä¸‹

```bash
#!/bin/sh
cd "${0%/*}" || exit 1                              # Run from this directory
#------------------------------------------------------------------------------

appPath=$(cd `dirname $0`; pwd)                     # Get application path
appName="${appPath##*/}"                            # Get application name

blockMesh -case debug_case | tee debug_case/log.mesh
echo "Meshing done."

$appName -case debug_case | tee debug_case/log.run

```

> - `$0` è¿”å›å½“å‰è„šæœ¬çš„ç»å¯¹è·¯å¾„
> - `%xxx` å»é™¤ xxx å­—ç¬¦
> - `/*` è¡¨ç¤º `/` åŠä¹‹åçš„æ‰€æœ‰å­—ç¬¦
> 
> ä¸ç”¨æ‹…å¿ƒè„šæœ¬è¯­è¨€ï¼Œæš‚æ—¶åªéœ€è¦çŸ¥é“ä½¿ç”¨ä¸Šè¿°è„šæœ¬å³å¯ï¼Œæ›´æ·±å…¥çš„è„šæœ¬è¯­è¨€ä¼šéšç€è®¨è®ºæ·±å…¥è€Œé€æ¸ä»‹ç»ã€‚


`caseclean` è„šæœ¬è´Ÿè´£æ¸…ç†è°ƒè¯•ç®—ä¾‹ï¼Œè¿˜åŸåˆ°åˆå§‹çŠ¶æ€ï¼Œå†…å®¹å¦‚ä¸‹

```bash
#!/bin/sh
cd "${0%/*}" || exit 1                              # Run from this directory
#------------------------------------------------------------------------------

appPath=$(cd `dirname $0`; pwd)
appName="${casePath##*/}"

cd debug_case

rm -rf log.*
foamCleanTutorials
echo "Cleaning Done."

```

è¿™ä¸¤ä¸ªè„šæœ¬è‡ªåŠ¨è·å–åº”ç”¨è·¯å¾„å’Œåº”ç”¨åç§°ï¼Œæ‰€ä»¥ä¹Ÿé€‚åˆåç»­è®¨è®ºçš„å…¶ä»–åº”ç”¨ä½¿ç”¨ï¼Œåªéœ€è¦å¤åˆ¶ä½¿ç”¨å³å¯ã€‚æ³¨æ„ï¼Œä¸Šè¿°å†™æ³•ä¸é€‚åˆ `.sh` æ–‡ä»¶æ ¼å¼ï¼Œå› ä¸ºè„šæœ¬è¯­è¨€çš„è¯­æ³•ä¼šå¯¼è‡´ä¸Šè¿°è„šæœ¬ä¸­çš„ `cd ` è¯­å¥æŠ¥é”™ã€‚

ä½¿è„šæœ¬ç”Ÿæ•ˆ

```
// termianl
chmod +x caserun caseclean
```

ä½¿ç”¨æ–¹æ³•

```
// terminal
./caserun
./caseclean
```

> é™¤éç‰¹æ®Šå¼ºè°ƒï¼Œä»¥åå‡ä½¿ç”¨è¿™ä¸¤ä¸ªè„šæœ¬ã€‚
### createTime.H

çœ‹ä¸€ä¸‹å’Œæ—¶é—´ç±»ç›¸å…³çš„å¤´æ–‡ä»¶ `createTime.H` 

```
// termianl
find $FOAM_SRC -iname createTime.H
// /usr/lib/openfoam/openfoam2306/src/OpenFOAM/include/createTime.H
```

> å¦‚æœä½¿ç”¨ `OFextension` å¯ä»¥ç›´æ¥è·³è½¬ã€‚

å†…å®¹å¦‚ä¸‹

```cpp
Foam::Info<< "Create time\n" << Foam::endl;

Foam::Time runTime(Foam::Time::controlDictName, args);
```

ç¬¬ä¸€è¡Œæ˜¯æ­£å¸¸çš„è¾“å‡ºè¯­å¥ã€‚

ç¬¬äºŒè¡Œæ„é€ äº†ä¸€ä¸ª `Foam::Time` ç±»å‹çš„ `runTime` å¯¹è±¡ï¼Œæ„é€ åŸºäº `controlDictName` å’Œ `args` ã€‚

> `args` éœ€è¦å…ˆåˆ›å»ºï¼Œæ‰€ä»¥ `createTime.H` è¦åœ¨ `setRootCase.H` ä¹‹å

`Time` æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„ç±»ï¼Œå…·æœ‰å¾ˆå¤šçš„æˆå‘˜æ•°æ®å’Œæˆå‘˜æ–¹æ³•ã€‚æˆ‘ä»¬å¤§æ¦‚æŒ‘å‡ å¤„ä»£ç ä½œä¸ºåˆ‡å…¥ç‚¹ç®€å•äº†è§£ä¸€ä¸‹ `Time` ç±»ã€‚

```
// termianl
find $FOAM_SRC -iname Time.H
// /usr/lib/openfoam/openfoam2306/src/OpenFOAM/db/Time/Time.H
```

> æ¨èä½¿ç”¨ `OFextension` æ’ä»¶ï¼Œç›´æ¥è·³è½¬æŸ¥çœ‹ï¼Œä»¥åä¸å†èµ˜è¿°ã€‚

æ‰“å¼€ `Time.H` ï¼Œå†…å®¹å¦‚ä¸‹

```cpp
...
class Time
:
    public clock,
    public cpuTime,
    public TimePaths,
    public objectRegistry,
    public TimeState
    // Timeç±»ç»§æ‰¿è‡ªæ›´å¤šçš„åŸºç±»
{
public:
	...
private:
	...
protected:
	...
private:
	...
public:
	...
	// åŸºäºå‚æ•°çš„æ„é€ å‡½æ•°
	inline Time
	(
		const word& ctrlDictName, // wordç±»å‹çš„å¼•ç”¨
		const argList& args, // argListç±»å‹çš„å¼•ç”¨
		const bool enableFunctionObjects = true,
		const bool enableLibs = true
	);
	// æ‰¾åˆ°è¿™ä¸ªå†…è”å‡½æ•°ï¼Œå°±æ˜¯ createTime.H ç¬¬2è¡Œçš„æ–¹æ³•åŸå‹
	// ç¬¬3ä¸ªå’Œç¬¬4ä¸ªå½¢å‚é»˜è®¤ä¸º trueï¼Œå¯ä»¥ä¸ç”¨ä¼ å…¥
	...
	// Timeç±»çš„æˆå‘˜å‡½æ•°
	virtual dimensionedScalar startTime() const;

	virtual dimensionedScalar endTime() const;
	...
...
```

æ–¹æ³•çš„å®ç°è¾ƒä¸ºå¤æ‚ï¼Œå¯¹äºç°é˜¶æ®µæ¥è¯´ï¼ŒåŸºç¡€ç±»æ²¡æœ‰å¿…è¦å»æ·±å…¥è®¨è®ºä»£ç çš„å®ç°éƒ¨åˆ†ï¼Œç›®å‰åªéœ€è¦åšåˆ°å¿ƒé‡Œæœ‰æ•°ã€çœ‹åˆ°ä¸é‚£ä¹ˆé™Œç”Ÿå³å¯ã€‚

### ä¸»æºç 

åœ¨ä¸»æºç ä¸­ä½¿ç”¨æ—¶é—´ç±»æ–¹æ³•å¦‚ä¸‹

```cpp
#include "fvCFD.H"

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

int main(int argc, char *argv[])
{
    #include "setRootCase.H"
    // #include "createTime.H"
    Foam::Info<< "Create time\n" << Foam::endl;
    Foam::Time runTime(Foam::Time::controlDictName, args);
    // è¿™ä¸¤è¡Œå°±æ˜¯ createTime.H

    Info<< "Case name   :   " << runTime.caseName() << endl; 
    Info<< "Root path   :   " << runTime.rootPath() << endl;
    Info<< "Path        :   " << runTime.path() << endl;
    Info<< "Time path   :   " << runTime.timePath() << endl;
    Info<< "Controdict  :   " << runTime.controlDict() << endl;
    Info<< "Format      :   " << runTime.writeFormat() << endl;
    Info<< "Version     :   " << runTime.writeVersion() << endl;
    Info<< "Start time  :   " << runTime.startTime() << endl;
    Info<< "End time    :   " << runTime.endTime() << endl;
    Info<< "Time step   :   " << runTime.deltaT() << endl;

    Info<< "# set end time = 10" << endl;
    runTime.setEndTime(10);

    Info<< "# set deltaT = 1" << endl;
    runTime.setDeltaT(1);

    Info<< "Start time  :   " << runTime.startTime() << endl;
    Info<< "End time    :   " << runTime.endTime() << endl;
    Info<< "Time step   :   " << runTime.deltaT() << endl;


    while (runTime.loop())
    {
        Info<< "Time: " << runTime.timeName() << endl;
        runTime.write();
    }

    // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

    Info<< nl;
    // runTime.printExecutionTime(Info);
    // å±•å¼€æˆå‘˜å‡½æ•° printExecutionTime() çš„ä¸»è¦å†…å®¹
    Info<< "Execution time: " << runTime.elapsedCpuTime() << " s" << endl;
    Info<< "Clock time: " << runTime.elapsedClockTime() << " s" << endl;

    Info<< "End\n" << endl;

    return 0;
}


// ************************************************************************* //

```

### ç¼–è¯‘è¿è¡Œ

é€šè¿‡ç»ˆç«¯ç¼–è¯‘è¿è¡Œæ­¤åº”ç”¨

```
// terminal
wmake
./caseclean
./caserun
```

è¿è¡Œç»“æœå¦‚ä¸‹

```
Create time

Case name   :   "debug_case"
Root path   :   "/home/aerosand/aerosand/ofsp/03_timeMesh/03_01_time"
Path        :   "/home/aerosand/aerosand/ofsp/03_timeMesh/03_01_time/debug_case"
Time path   :   "/home/aerosand/aerosand/ofsp/03_timeMesh/03_01_time/debug_case/0"
Controdict  :   
{
    application     icoFoam;
    startFrom       startTime;
    startTime       0;
    stopAt          endTime;
    endTime         0.5;
    deltaT          0.005;
    writeControl    timeStep;
    writeInterval   20;
    purgeWrite      0;
    writeFormat     ascii;
    writePrecision  6;
    writeCompression off;
    timeFormat      general;
    timePrecision   6;
    runTimeModifiable true;
}

Format      :   ascii
Version     :   2.0
Start time  :   startTime [0 0 1 0 0 0 0] 0
End time    :   endTime [0 0 1 0 0 0 0] 0.5
Time step   :   deltaT [0 0 1 0 0 0 0] 0.005
# set end time = 10
# set deltaT = 1
Start time  :   startTime [0 0 1 0 0 0 0] 0
End time    :   endTime [0 0 1 0 0 0 0] 10
Time step   :   deltaT [0 0 1 0 0 0 0] 1
Time: 1
Time: 2
Time: 3
Time: 4
Time: 5
Time: 6
Time: 7
Time: 8
Time: 9
Time: 10

Execution time: 0 s
Clock time: 0 s
End


```


## å°ç»“

åŠ ä¸Šä¹‹å‰çš„è®¨è®ºï¼Œæˆ‘ä»¬å·²ç»å¤§ä½“ç†è§£ OpenFOAM åº”ç”¨ä¸­å¸¸è§çš„ `setRootCase.H` å’Œ `createTime.H` å¤´æ–‡ä»¶ï¼Œä¸‹ä¸€ç¯‡å°†è®¨è®ºæœ€åä¸€ä¸ªå¿…å¤‡å¤´æ–‡ä»¶ `createMesh.H` ã€‚

