---
uid: 20250827141152
title: ofsp2025-09
date: 2025-08-27
update: 2025-08-27
authors:
  - name: Aerosand
    link: https://github.com/aerosand
    image: https://github.com/aerosand.png
tags:
  - ofsp2025
  - OpenFOAM
excludeSearch: false
toc: true
weight: 10
math: true
next:
prev:
comments: true
sidebar:
  exclude: false
draft: false
---

> å‚è€ƒï¼š
> - https://github.com/UnnamedMoose/BasicOpenFOAMProgrammingTutorials
> - https://www.topcfd.cn/simulation/solve/openfoam/openfoam-program/
> - https://www.tfd.chalmers.se/~hani/kurser/OS_CFD/
> - https://github.com/ParticulateFlow/OSCCAR-doc/blob/master/openFoamUserManual_PFM.pdf
> - https://www.youtube.com/watch?v=KB9HhggUi_E&ab_channel=UCLOpenFOAMWorkshop
> - http://dyfluid.com/#
> - https://ss1.xrea.com/penguinitis.g1.xrea.com/study/OpenFOAM/index.html
> 
> æ„Ÿè°¢åŸä½œè€…ä»¬çš„æ— ç§å¼•è·¯å’Œå®è´µå·¥ä½œã€‚


> å‰ç½®ï¼š
> [OpenFOAMåŸºç¡€ç®—æ³• SIMPLE & PISO & PIMPLE | ğ“ğ“®ğ“»ğ“¸ğ“¼ğ“ªğ“·ğ“­ (aerosand.cn)](https://aerosand.cn/posts/20230511151000/)

å‰é¢å·²ç»è®¨è®ºäº†å®šå¸¸æ ‡é‡è¾“è¿æ–¹ç¨‹çš„æ±‚è§£ã€éå®šå¸¸æ³¢åŠ¨æ–¹ç¨‹çš„æ±‚è§£ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¿›ä¸€æ­¥å­¦ä¹ ï¼Œå¯èƒ½åœ¨ç½‘ä¸Šå¾ˆå¤šæ•™ç¨‹éƒ½æ¨èä» icoFoam å¼€å§‹å­¦ä¹ ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æ‰“å¼€ icoFoam æ±‚è§£å™¨çš„æºä»£ç ï¼Œä¼šå‘ç°æ‰‹è¶³æ— æªï¼Œé™Œç”Ÿçš„ä»£ç å’Œç®—æ³•æŠŠæˆ‘ä»¬è’™åœ¨äº†çª—æˆ·çº¸åé¢ï¼Œé˜»ç¢æˆ‘ä»¬å‰è¿›ã€‚

äº‹å®ä¸Šï¼Œåˆå­¦è€…åœ¨çœ‹ OpenFOAM æ ‡å‡†æ±‚è§£å™¨ä¹‹å‰åº”è¯¥æœ‰ä¸¤ä»¶äº‹è¦åš

1. ç†è§£ç®—æ³• [OpenFOAMç®—æ³• SIMPLE & PISO & PIMPLE | ğ“ğ“®ğ“»ğ“¸ğ“¼ğ“ªğ“·ğ“­ (aerosand.cn)](https://aerosand.cn/posts/20230511151000/)
	- è¿™ç¯‡ç®—æ³•è®¨è®ºå…¶å®å·²ç»å†™äº†ä¸å°‘ä»£ç çš„å®ç°éƒ¨åˆ† 
2. ç›´è§‚çš„ SIMPLE ç®—æ³•å®ç°
	- æ²¡æœ‰ä»»ä½• SIMPLE ä»¥å¤–åŠŸèƒ½çš„ä»£ç 


æ‰€ä»¥æˆ‘ä»¬ä»ç„¶ä¸æ€¥äºçœ‹ `icoFoam` æ±‚è§£å™¨æˆ–è€…å…¶ä»–æ ‡å‡†æ±‚è§£å™¨ã€‚ä¸‹é¢æˆ‘ä»¬ä¸è€ƒè™‘ä»»ä½•çš„ä¼˜åŒ–ã€ä¹Ÿä¸è€ƒè™‘æ”¶æ•›æ£€æŸ¥ç­‰ç­‰é¢å¤–çš„åŠŸèƒ½ï¼Œå•ä» SIMPLE ç®—æ³•å‡ºå‘ï¼Œç›´è§‚åœ°åœ¨ OpenFOAM ä¸­å®ç°è¯¥ç®—æ³•çš„æ±‚è§£å™¨ã€‚

æ§åˆ¶æ–¹ç¨‹å¦‚ä¸‹

$$ \nabla\cdot U = 0 \tag{1}$$
$$
\frac{\partial U}{\partial t} + \nabla\cdot UU - \nabla\cdot(\mu\nabla U) = -\nabla p \tag{2}
$$

å»ºç«‹æœ¬æ–‡é¡¹ç›®æ–‡ä»¶å¤¹

```
// terminal
ofsp
mkdir 09_simple
cd 09_simple
```
## åº”ç”¨å‡†å¤‡

```
// terminal
foamNewApp 09_01_simple
cd 09_01_simple
cp -r $FOAM_TUTORIALS/incompressible/icoFoam/cavity/cavity debug_case
cp /home/aerosand{caserun,caseclean} .
```

## è„šæœ¬å’Œè¯´æ˜

ç•¥ã€‚
## æ±‚è§£å™¨

### createFields.H

æ–‡ä»¶ `/userApp/createFields.H` å†…å®¹å¦‚ä¸‹

```cpp
/*
* Contents
*   # Basic fields
*   # Transport properties
*/

/*
* # Basic fields
*/

Info<< "Reading field p\n" << endl;
volScalarField p
(
    IOobject
    (
        "p",
        runTime.timeName(),
        mesh,
        IOobject::MUST_READ,
        IOobject::AUTO_WRITE
    ),
    mesh
);

Info<< "Reading field U\n" << endl;
volVectorField U
(
    IOobject
    (
        "U",
        runTime.timeName(),
        mesh,
        IOobject::MUST_READ,
        IOobject::AUTO_WRITE
    ),
    mesh
);


Info<< "Creating old layer pressure field p_old\n" << endl;
volScalarField p_old
(
    IOobject
    (
        "p_old",
        runTime.timeName(),
        mesh,
        IOobject::NO_READ,
        IOobject::NO_WRITE
    ),
    p
);
// å› ä¸ºå‹åŠ›åœºè¦åšæ¾å¼›å¤„ç†ï¼Œæ‰€ä»¥éœ€è¦å¤åˆ¶ä¸€ä»½ p åœº

#include "createPhi.H"

/*
* # Transport properties
*/

Info<< "Reading transportProperties\n" << endl;
IOdictionary transportProperties
(
    IOobject
    (
        "transportProperties",
        runTime.constant(),
        mesh,
        IOobject::MUST_READ_IF_MODIFIED,
        IOobject::NO_WRITE
    )
);

dimensionedScalar nu
(
    "nu",
    dimensionSet(0, 2, -1, 0, 0, 0, 0),
    transportProperties
);

```

### ä¸»æºç 

ä¸»æºç ä¸­åº”ç”¨ SIMPLE ç®—æ³•ï¼Œå®ç°å¦‚ä¸‹

```cpp
#include "fvCFD.H"

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

int main(int argc, char *argv[])
{
    #include "setRootCase.H"
    #include "createTime.H"

    #include "createMesh.H"

    #include "createFields.H" // åˆ›å»ºåœºã€è¾“è¿å‚æ•°
    
    // è¯»å–ä»£æ•°æ±‚è§£å™¨å‚æ•°
    Info<< "Reading fvSolutino\n" << endl;
	IOdictionary fvSolution
	(
	    IOobject
	    (
	        "fvSolution",
	        runTime.system(),
	        mesh,
	        IOobject::MUST_READ_IF_MODIFIED,
	        IOobject::NO_WRITE
	    )
	);

	// scalar alpha(readScalar(fvSolution.lookup("alpha")));
	dimensionedScalar alphaD("alpha",dimless,fvSolution);
	scalar alpha(alphaD.value());
	
	// scalar pRefCell(readScalar(fvSolution.lookup("pRefCell")));
	dimensionedScalar pRefCellD("pRefCell",dimless,fvSolution);
	scalar pRefCell(pRefCellD.value());
	
	// scalar pRefValue(readScalar(fvSolution.lookup("pRefValue")));
	dimensionedScalar pRefValueD("pRefValue",dimless,fvSolution);
	scalar pRefValue(pRefValueD.value());

	// è¾“å‡ºåˆšæ‰è¯»å–çš„ä»£æ•°æ±‚è§£å™¨å‚æ•°
    Info<< "fvSolution parameters" << nl
        << "\trelaxation factor \"alpha\": " << alpha << nl
        << "\tindex of cell containing reference pressure \"pRefCell\": " << pRefCell << nl
        << "\treference pressure value \"pRefValue\": " << pRefValue << nl
        << endl;

	// æ—¶é—´æ¨è¿›
    Info<< "\nStarting time loop\n" << endl;

    while (runTime.loop())
    {
        Info<< "Time = " << runTime.timeName() << endl;

        // ç»„å»ºåŠ¨é‡æ–¹ç¨‹
        fvVectorMatrix UEqn
        (
            fvm::div(phi,U)
            - fvm::laplacian(nu,U)
            == 
            - fvc::grad(p)
        );

		// æ±‚è§£åŠ¨é‡æ–¹ç¨‹
        UEqn.solve();


        // ç»„å»ºå‹åŠ›æ–¹ç¨‹
        volScalarField A = UEqn.A();
        volVectorField H = UEqn.H();

        volScalarField rA = 1.0 / A;

        volVectorField HbyA = H * rA;

        fvScalarMatrix pEqn
        (
            fvm::laplacian(rA,p)
            ==
            fvc::div(HbyA)
        );

        pEqn.setReference(pRefCell,pRefValue); // ä¸ºä»€ä¹ˆè¦è®¾å‚è€ƒå€¼ï¼Ÿ

		// æ±‚è§£å‹åŠ›æ–¹ç¨‹
        pEqn.solve();

		// æ¬ æ¾å¼›å¤„ç†
        p = alpha*p + (1.0-alpha)*p_old;

		// æ›´æ–°é€Ÿåº¦åœº
        U = rA*H - rA*fvc::grad(p);

		// æ±‚è§£è´¨é‡é€šé‡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ flux() å‡½æ•°
        phi = fvc::interpolate(U) & mesh.Sf();
		// phi = fvc::flux(U);

		// è¾¹ç•Œæ¡ä»¶ä¿®æ­£ï¼Œæš‚ä¸æ·±ç©¶
        U.correctBoundaryConditions();
        p.correctBoundaryConditions();

		// æ›´æ–°æ—§æ—¶é—´æ­¥åœºé‡ï¼Œç”¨äºä¸‹ä¸€æ¬¡æ¬ æ¾å¼›å¤„ç†
        p_old = p;

        runTime.write();
    }

    // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

    Info<< nl;
    runTime.printExecutionTime(Info);

    Info<< "End\n" << endl;

    return 0;
}


// ************************************************************************* //

```

> å‚è€ƒå‹åŠ›è§£é‡Šå¯è§ [å…³äºfluentä¸­çš„å‹åŠ›ï¼ˆä¸€ï¼‰ - å¸Œæœ›å…ˆç”Ÿ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/Xiwang-Sun/p/15485593.html)
### ç¼–è¯‘

```
// terminal 
wclean
wmake
```

## è°ƒè¯•ç®—ä¾‹

- `system/blockMeshDict` æ— éœ€ä¿®æ”¹ï¼Œæˆ‘ä»¬ä»ç„¶ä½¿ç”¨åŸå‡ ä½•æ¨¡å‹å’Œå‡ ä½•ç½‘æ ¼
- `system/controlDict` æ— éœ€ä¿®æ”¹ï¼Œæˆ‘ä»¬ä»ç„¶ä½¿ç”¨æ±‚è§£æ§åˆ¶çš„è®¾ç½®ï¼ˆæ­¥é•¿æ­¥æ•°ç­‰ï¼‰
- `decomposedParDict` å’Œ `PDRblockMeshDict` ä¸ç”¨ç®¡ï¼Œæœ¬æ–‡ç”¨ä¸åˆ°
- `constant/transportProperties.H` æ— éœ€ä¿®æ”¹ï¼Œæˆ‘ä»¬æ²¿ç”¨ç²˜åº¦å‚æ•°
- `debug_case/0/` åˆå§‹æ¡ä»¶æ— éœ€ä¿®æ”¹
### fvSchemes

æ³¨æ„å„ä¸ªæ ¼å¼éœ€è¦è‡³å°‘æä¾›é»˜è®¤å€¼ï¼Œä¾‹å¦‚

```cpp
divSchemes
{
    default         Gauss linear;
}
```

### fvSolution

æœ€åæ·»åŠ è¯­å¥ 

```cpp
alpha       0.01;

pRefCell    0;

pRefValue   0;
```

### controlDict

è‡ªè¡Œå°è¯•æ›´æ”¹è®¡ç®—å‚æ•°

### è®¡ç®—

```
// terminal
./caseclean
./caserun

paraFoam -case _case
```

å¯ä»¥çœ‹åˆ°è®¡ç®—ç»“æœã€‚

## æ•´ç†ä»£ç 

æˆ‘ä»¬å¯ä»¥æŠŠä»£ç æ•´ç†ä¸ºå¦‚ä¸‹æ–‡ä»¶ç»“æ„

```
|- userApp/
	|- debug_case/
	|- Make/
		|- files/
		|- options/
	|- 09_01_simple.C
	|- createFields.H
	|- readfvSolution.H
	|- pEqn.H
	|- UEqn.H
	|- caserun
	|- caseclean
```

### ä¸»æºç 

```cpp
#include "fvCFD.H"

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

int main(int argc, char *argv[])
{
    #include "setRootCase.H"
    #include "createTime.H"

    #include "createMesh.H"

    #include "createFields.H"
    #include "readfvSolution.H"

    Info<< "\nStarting time loop\n" << endl;

    while (runTime.loop())
    {
        Info<< "Time = " << runTime.timeName() << endl;

        #include "UEqn.H"

        #include "pEqn.H"

        runTime.write();
    }

    // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

    Info<< nl;
    runTime.printExecutionTime(Info);

    Info<< "End\n" << endl;

    return 0;
}


// ************************************************************************* //

```

### readfvSolution.H

```cpp
Info<< "Reading fvSolutino\n" << endl;
IOdictionary fvSolution
(
    IOobject
    (
        "fvSolution",
        runTime.system(),
        mesh,
        IOobject::MUST_READ_IF_MODIFIED,
        IOobject::NO_WRITE
    )
);

// scalar alpha(readScalar(fvSolution.lookup("alpha")));
dimensionedScalar alphaD("alpha",dimless,fvSolution);
scalar alpha(alphaD.value());

// scalar pRefCell(readScalar(fvSolution.lookup("pRefCell")));
dimensionedScalar pRefCellD("pRefCell",dimless,fvSolution);
scalar pRefCell(pRefCellD.value());

// scalar pRefValue(readScalar(fvSolution.lookup("pRefValue")));
dimensionedScalar pRefValueD("pRefValue",dimless,fvSolution);
scalar pRefValue(pRefValueD.value());

Info<< "fvSolution parameters" << nl
    << "\trelaxation factor \"alpha\": " << alpha << nl
    << "\tindex of cell containing reference pressure \"pRefCell\": " << pRefCell << nl
    << "\treference pressure value \"pRefValue\": " << pRefValue << nl
    << endl;

```

### UEqn.H

```cpp
fvVectorMatrix UEqn
(
    fvm::div(phi,U)
    - fvm::laplacian(nu,U)
    == 
    - fvc::grad(p)
);

UEqn.solve();

```

### pEqn.H

```cpp
volScalarField A = UEqn.A();
volVectorField H = UEqn.H();

volScalarField rA = 1.0 / A;

volVectorField HbyA = H * rA;

fvScalarMatrix pEqn
(
    fvm::laplacian(rA,p)
    ==
    fvc::div(HbyA)
);

pEqn.setReference(pRefCell,pRefValue);

pEqn.solve();

p = alpha*p + (1.0-alpha)*p_old; // å‹åŠ›æ¾å¼›

U = rA*H - rA*fvc::grad(p);

phi = fvc::interpolate(U) & mesh.Sf();

U.correctBoundaryConditions();
p.correctBoundaryConditions();

p_old = p;

```

### ç¼–è¯‘è®¡ç®—

ä»ç„¶ä½¿ç”¨ä¸Šé¢çš„è°ƒè¯•ç®—ä¾‹ï¼Œç»“æœæ˜¯ç›¸åŒçš„ã€‚

## å°ç»“

æˆ‘ä»¬é€šè¿‡ç™¾åˆ†ç™¾è¿˜åŸæ•°å­¦æ–¹ç¨‹ï¼Œæ²¡æœ‰åŠ å…¥å…¶ä»–ä»»ä½•åŠŸèƒ½ï¼Œæœ€åæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå•çº¯åŸºäº `SIMPLE` ç®—æ³•çš„æ±‚è§£å™¨ã€‚
