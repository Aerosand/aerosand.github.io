---
uid: 20250723105353
title: ofsp2025-02
date: 2025-07-23
update: 2025-08-27
authors:
  - name: Aerosand
    link: https://github.com/aerosand
    image: https://github.com/aerosand.png
tags:
  - ofsp2025
  - OpenFOAM
excludeSearch: false
toc: true
weight: 2
math: true
next: 
prev: 
comments: true
sidebar:
  exclude: false
draft: false
---

> å‚è€ƒï¼š
> - https://github.com/UnnamedMoose/BasicOpenFOAMProgrammingTutorials
> - https://www.topcfd.cn/simulation/solve/openfoam/openfoam-program/
> - https://www.tfd.chalmers.se/~hani/kurser/OS_CFD/
> - https://github.com/ParticulateFlow/OSCCAR-doc/blob/master/openFoamUserManual_PFM.pdf
> - https://www.youtube.com/watch?v=KB9HhggUi_E&ab_channel=UCLOpenFOAMWorkshop
> - http://dyfluid.com/#
> - https://ss1.xrea.com/penguinitis.g1.xrea.com/study/OpenFOAM/index.html
> 
> æ„Ÿè°¢åŸä½œè€…ä»¬çš„æ— ç§å¼•è·¯å’Œå®è´µå·¥ä½œã€‚

> å‰ç½®ï¼š  
>  [OpenFOAM Sharing Programming å¼€å‘ç¼–ç¨‹åŸºç¡€00 åŸºæœ¬å®ç°å’Œå¼€å‘ | ğ“ğ“®ğ“»ğ“¸ğ“¼ğ“ªğ“·ğ“­](https://aerosand.cn/posts/20230502112308/)
>  
> è¿™é‡Œéœ€è¦é‡ç”³ OpenFOAM åˆå­¦è€…çš„ C++ å­¦ä¹ çš„ä¸ªäººå»ºè®®ï¼šç›®å‰é˜¶æ®µï¼Œéœ€è¦ç³»ç»Ÿå­¦ä¹  C++ é¢å‘å¯¹è±¡åŸºç¡€ï¼Œæš‚æ—¶ä¸éœ€è¦æŒæ¡ C++ é«˜çº§ç‰¹æ€§ï¼Œæš‚æ—¶ä¸éœ€è¦å­¦ä¹ ç¼–ç¨‹ç®—æ³•ï¼Œä¸éœ€è¦ç­‰åˆ°å­¦å®Œ C++ å†å¼€å§‹ OpenFOAMã€‚éœ€è¦ä¸æ–­å­¦ä¹  C++ï¼Œéœ€è¦æ…¢æ…¢æ·±å…¥å­¦ä¹  C++ï¼Œéœ€è¦åœ¨ä¸æ–­çš„å®è·µä¸­ç§¯ç´¯ C++ ç»éªŒã€‚

åœ¨åšè®¡ç®—æˆ–è€…å…¶ä»–äº¤äº’å·¥ä½œçš„æ—¶å€™ï¼Œä¿¡æ¯æµçš„å†™å…¥å†™å‡ºæ˜¯ä¸å¯é¿å…çš„ã€‚æ¯”å¦‚ä»æ–‡ä»¶ä¸­è¯»å–è®¡ç®—å‚æ•°ã€è¯»å–ææ–™æ€§è´¨ï¼Œåˆæˆ–è€…æ˜¯å‘æ–‡ä»¶å†™å…¥è®¡ç®—åçš„ç‰©ç†åœºã€‚

æ‰€ä»¥ï¼Œåœ¨äº†è§£åº”ç”¨çš„åŸºæœ¬å®ç°å’Œå¼€å‘åï¼Œæˆ‘ä»¬ç´§æ¥ç€è®¨è®ºä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºè¾“å‡ºã€‚

> æœ¬æ–‡ä¾ç„¶åŸºäº ubuntu 24.04 ç³»ç»Ÿï¼ŒOpenFOAM 2406 ç‰ˆæœ¬ï¼ˆå’Œ 2212 ç‰ˆæœ¬ï¼Œ2206 ç‰ˆæœ¬å‡ ä¹æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ï¼Œä¸ç”¨æ‹…å¿ƒï¼‰ã€‚æ­¤ç³»åˆ—ä»¥åä¸å†èµ˜è¿°ã€‚


## C++ å®ç°

æˆ‘ä»¬å·²ç»çŸ¥é“ C++ å¯ä»¥é€šè¿‡è¾“å…¥è¾“å‡ºæµæ¥å®ç°ä»æ–‡ä»¶ä¸­è¯»å–æˆ–è€…å‘æ–‡ä»¶ä¸­å†™å…¥ã€‚

æ‹·è´æ ‡å‡†ç®—ä¾‹åˆ° `run` æ–‡ä»¶å¤¹ä¸‹ã€‚ï¼ˆå¦‚æœä½¿ç”¨ `run` æŒ‡ä»¤æ— æ•ˆçš„ï¼Œå‚è€ƒ [OpenFOAMç¯å¢ƒå‡†å¤‡ | ğ“ğ“®ğ“»ğ“¸ğ“¼ğ“ªğ“·ğ“­](https://aerosand.cn/posts/20230331145640/) å»ºç«‹ç›¸åº”æ–‡ä»¶å¤¹ ï¼‰

```terminal
// terminal
run
cp -r $FOAM_TUTORIALS/incompressible/icoFoam/cavity/cavity .
```

æ‰“å¼€è¯¥ç®—ä¾‹ï¼ŒæŸ¥çœ‹ `constant/transportProperties` æ–‡ä»¶å’Œ `system/controlDict` æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªå…³é”®è¯éƒ½å¯¹åº”ç€ç”¨æˆ·ç»™å®šçš„å€¼ï¼Œè¿™äº›å…³é”®è¯åçš„å€¼åœ¨æ±‚è§£è¿‡ç¨‹ä¸­ï¼Œå½“ç„¶ä¹Ÿä¼šè¢«ç¨‹åºè¯»å…¥ã€‚

> é˜…è¯» `transportProperties` æ–‡ä»¶å’Œ `controlDict` æ–‡ä»¶çš„æ–‡ä»¶å¤´ï¼Œå¯ä»¥æ˜ç™½ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶å…¶å®éƒ½æ˜¯â€œå­—å…¸â€æ–‡ä»¶ã€‚è™½ç„¶ä¸¤è€…å‘ä¸»ç¨‹åºè¾“å…¥å‚æ•°çš„æœºåˆ¶ä¸åŒï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å…ˆè¡Œç®€å•ç†è§£å‘ä¸»ç¨‹åºè¾“å…¥å‚æ•°çš„ä¸»è¦æ€è·¯ã€‚è¿™æ ·ä¹Ÿå¯ä»¥åœ¨å…¥é—¨é˜¶æ®µæ›´å¥½ç†è§£å­—å…¸æ–‡ä»¶çš„æ„ä¹‰ã€‚

å­—å…¸çš„æ ¼å¼å¦‚ä¸‹

```
// transportProperties

nu              0.01;


// controlDict

...

application     icoFoam;

startFrom       startTime;

startTime       0;

stopAt          endTime;

...
```

è®¡ç®—è¯¥ç®—ä¾‹

```terminal
// terminal
blockMesh
icoFoam

// use foamCleanTutorials to clean case
```

å¯ä»¥å¾ˆå¿«å¾—åˆ°è®¡ç®—ç»“æœï¼Œæˆ‘ä»¬æ‰“å¼€æœ€ç»ˆæ—¶é—´æ­¥çš„é€Ÿåº¦åœºï¼ˆ`0.5/U`ï¼‰ï¼ŒæŸ¥çœ‹è¾“å‡ºçš„æ ¼å¼

```cpp
// U field
dimensions      [0 1 -1 0 0 0 0];

internalField   nonuniform List<vector> 
400
(
(0.000253405 -0.000250456 0)
(0.000141206 0.000111424 0)
(-0.00117704 0.000564623 0)
(-0.00348128 0.00088502 0)
...
)
;
...
```

ä¸‹é¢ï¼Œæˆ‘ä»¬å°è¯•è®¨è®ºå’Œç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼Œå³

- ä»å¤–éƒ¨æ–‡ä»¶å‘ä¸»ç¨‹åºè¾“å…¥å‚æ•°
- ä»ä¸»ç¨‹åºå‘å¤–éƒ¨æ–‡ä»¶è¾“å‡ºç»“æœ

### æ–‡ä»¶æµ

åœ¨åˆå­¦çš„æ—¶å€™æˆ‘ä»¬å°±çŸ¥é“ C++ æä¾› `iostream` æ ‡å‡†åº“ï¼ŒåŒ…å« `cin` å’Œ `cout` æ–¹æ³•ï¼Œç”¨äºä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ä¿¡æ¯æµï¼Œæˆ–è€…ä»æ ‡å‡†è¾“å‡ºä¸­å†™å…¥ä¿¡æ¯æµã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒC++ è¿˜æä¾› `fstream` æ ‡å‡†åº“ï¼Œç”¨äºå¤–éƒ¨æ–‡ä»¶å’Œä¿¡æ¯æµä¹‹é—´çš„äº¤äº’ã€‚

- `ofstream` è¡¨ç¤ºè¾“å‡ºæ–‡ä»¶æµï¼Œç”¨äºåˆ›å»ºæ–‡ä»¶å¹¶å‘æ–‡ä»¶å†™å…¥ä¿¡æ¯
- `ifstream` è¡¨ç¤ºè¾“å…¥æ–‡ä»¶æµï¼Œç”¨äºä»æ–‡ä»¶è¯»å–ä¿¡æ¯
- `fstream` è¡¨ç¤ºé€šç”¨æ–‡ä»¶æµï¼ŒåŒæ—¶å…·æœ‰å†™å…¥å†™å‡ºçš„æ–¹æ³•

å…·ä½“çœ‹ä¸€ä¸‹æ€ä¹ˆä½¿ç”¨æ–‡ä»¶æµã€‚

### é¡¹ç›®å‡†å¤‡

å»ºç«‹æœ¬æ–‡çš„é¡¹ç›®æ–‡ä»¶å¤¹

```
// terminal
ofsp
mkdir ofsp_01_IO_cpp
```

é€šè¿‡ vscode çš„ `C/C++ Project Generater` æ‰“å¼€æ–°é¡¹ç›® `ofsp_01_IO_cpp`ã€‚

### é¡¹ç›®å®ç°

æˆ‘ä»¬é€šè¿‡è¯¥é¡¹ç›®æ¨¡æ‹Ÿæ±‚è§£å™¨è¯»å–ç®—ä¾‹çš„å­—å…¸æ–‡ä»¶çš„å‚æ•°ã€‚

ä¸»æºç  `src/main.cpp` å¦‚ä¸‹æ‰€ç¤º

```cpp
#include <iostream> // IOæ ‡å‡†åº“
#include <string> // å­—ç¬¦ä¸²åº“
#include <fstream> // æ–‡ä»¶æµåº“
#include <cassert> // å¼‚å¸¸åˆ¤æ–­åº“

int main(int argc, char *argv[])
{
	// ç»™å¤–éƒ¨å‚æ•°å‡†å¤‡å˜é‡
	double viscosity;
    std::string application;
    double deltaT;
    int writeInterval;
    bool purgeWrite;
    std::string var[5];

    std::fstream infile; // å®šä¹‰ä¸€ä¸ªæ–‡ä»¶æµ
    infile.open("ofspProperties", std::fstream::in); // æ‰“å¼€æ–‡ä»¶å¹¶å‡†å¤‡è¯»å–
    if (!infile) { // å¼‚å¸¸åˆ¤æ–­ï¼Œå¦‚æœæ‰“å¼€å¤±è´¥ï¼Œåˆ™æ‰§è¡Œä¸‹é¢
        std::cout << "# WARNING: NO input!" << std::endl;
        assert(infile); // ç»ˆæ­¢ç¨‹åºå¹¶æŠ›å‡ºé”™è¯¯ä¿¡æ¯ï¼ˆé¢‘ç¹è°ƒç”¨å½±å“æ€§èƒ½ï¼‰
    }
    infile >> var[0] >> viscosity;
    infile >> var[1] >> application;
    infile >> var[2] >> deltaT;
    infile >> var[3] >> writeInterval;
    infile >> var[4] >> purgeWrite;
    infile.close(); // å¿…é¡»å…³é—­æ–‡ä»¶

    std::cout << std::endl
        << var[0] << "\t\t" << viscosity << std::endl
        << var[1] << "\t" << application << std::endl
        << var[2] << "\t\t" << deltaT << std::endl
        << var[3] << "\t" << writeInterval << std::endl
        << var[4] << "\t" << purgeWrite << std::endl
        << std::endl;


    // may we got the field U
    int nCells = 4;
    int dimension = 3;
    double initVelocity = 0.1;
    double fieldU[nCells][dimension] = {0};
    for (int i = 0; i < nCells; ++i)
    {
        for (int j = 0; j < dimension; ++j)
        {
            fieldU[i][j] = initVelocity * i * deltaT;
        }
    }

    // output our field U 
    std::fstream outfile;
    outfile.open("U", std::fstream::out); // æ‰“å¼€æ–‡ä»¶å¹¶å‡†å¤‡å†™å…¥
    outfile << "internalField\tnonuniform List<vector>" << std::endl;
    outfile << nCells << "\n(" <<  std::endl;
    for (int i = 0; i < nCells; ++i)
    {
        outfile << "( ";
        for (int j = 0; j < dimension; ++j)
        {
            outfile << fieldU[i][j] << " ";
        }
        outfile << ")\n";
    }
    outfile << ")\n;";

    outfile.close(); // å¿…é¡»å…³é—­æ–‡ä»¶

	// ç°ä»£ C++ å¯ä»¥ä¸å†™ return 0;
}
```

æˆ‘ä»¬åŒæ ·ä¸ºè¯¥é¡¹ç›®æä¾›æ¨¡ä»¿å­—å…¸çš„æ–‡ä»¶ã€‚`ofspProperties` æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼ˆè·¯å¾„ä¸º `/ofsp/ofsp_01_IO_cpp/ofspProperties`ï¼‰

```
nu                  0.01
application         laplacianFoam
deltaT              0.005
writeInterval       20
purgeWrite          0
```

### ç¼–è¯‘è¿è¡Œ

ç»ˆç«¯ç¼–è¯‘å¹¶è¿è¡Œæ­¤é¡¹ç›®

```
// terminal
make clean
make run
```

è¿è¡Œç»“æœå¦‚ä¸‹

```
g++ -std=c++17 -Wall -Wextra -g -Iinclude -c -MMD src/main.cpp  -o src/main.o
src/main.cpp: In function â€˜int main(int, char**)â€™:
src/main.cpp:6:14: warning: unused parameter â€˜argcâ€™ [-Wunused-parameter]
    6 | int main(int argc, char *argv[])
      |          ~~~~^~~~
src/main.cpp:6:26: warning: unused parameter â€˜argvâ€™ [-Wunused-parameter]
    6 | int main(int argc, char *argv[])
      |                    ~~~~~~^~~~~~
g++ -std=c++17 -Wall -Wextra -g -Iinclude -o output/main src/main.o  -Llib
Executing all complete!
./output/main

nu              0.01
application     laplacianFoam
deltaT          0.005
writeInterval   20
purgeWrite      0

Executing run: all complete!
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸€é¡¹å¤–éƒ¨æ–‡ä»¶çš„å…³é”®è¯åçš„å‚æ•°éƒ½è¢«è¯»å…¥äº†ç¨‹åºï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­æ“ä½œæˆ–è¾“å‡ºã€‚

åŒæ—¶å‘ç°é¡¹ç›®æ ¹ç›®å½•ä¸‹ç”Ÿæˆäº† `U` æ–‡ä»¶ï¼Œæ‰“å¼€çœ‹åˆ°å…¶ä¸­å†…å®¹ä¸º

```
internalField	nonuniform List<vector>
4
(
( 0 0 0 )
( 0.0005 0.0005 0.0005 )
( 0.001 0.001 0.001 )
( 0.0015 0.0015 0.0015 )
)
;
```

æ ¼å¼å’Œ OpenFOAM çš„è¾“å‡ºé€Ÿåº¦åœºçš„æ ¼å¼ç±»ä¼¼ã€‚

é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•ç†è§£ï¼Œ OpenFOAM æ±‚è§£å™¨æ˜¯å¦‚ä½•é€šè¿‡å­—å…¸æ–‡ä»¶æ‹¿åˆ°å‚æ•°æŒ‡å®šçš„å€¼ã€‚æ±‚è§£å™¨è¾“å‡ºçš„è®¡ç®—ç»“æœå‘¢ï¼Œæœ¬è´¨ä¸Šæ˜¯ OpenFOAM å¯ä»¥è¯†åˆ«ï¼Œåå¤„ç†è½¯ä»¶å¯ä»¥è¯†åˆ«çš„ï¼Œæœ‰ç‰¹å®šæ’ç‰ˆæ ¼å¼çš„æ–‡ä»¶ã€‚

## é‡æ„é¡¹ç›®

è®©æˆ‘ä»¬åœä¸‹è„šæ­¥ï¼Œä»”ç»†æƒ³ä¸€ä¸‹ä¸Šé¢çš„é¡¹ç›®ã€‚æˆ‘ä»¬å¾ˆéš¾ç§°å®ƒæ˜¯æŒ‰å…³é”®è¯è¯»å–ï¼Œå› ä¸ºä»£ç åªæ˜¯å®ç°äº†è¯»å–ã€‚å¦‚æœæˆ‘ä»¬æ›´æ”¹è¾“å…¥æ–‡ä»¶çš„å…³é”®è¯é¡ºåºï¼Œå°±ä¼šå¯¼è‡´ä¼ å…¥å‚æ•°çš„ä¸ä¸€è‡´ï¼ˆè¯»è€…å¯ä»¥å°è¯•æ›´æ¢ ofspProperties æ–‡ä»¶ä¸­å…³é”®è¯é¡ºåºï¼Œé‡æ–°è¿è¡Œä»£ç ï¼ŒæŸ¥çœ‹ç»“æœï¼‰ã€‚

æˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸‹å¦‚ä½•çœŸæ­£çš„æŒ‰å…³é”®è¯è¯»å–ã€‚

### OF åŸç”Ÿè¯»å‚

æˆ‘ä»¬çœ‹ä¸€ä¸‹ OpenFOAM ä¸­ä¸€äº›ç®€å•ç±»å‹çš„å‚æ•°çš„è¯»å–è¯­å¥æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚

OpenFOAM æä¾› `lookup()` å‡½æ•°æ¥æŒ‰å…³é”®è¯è¯»å–ï¼Œç±»ä¼¼äºå¦‚ä¸‹å½¢å¼

```cpp
IOdictionary transportProperties
(
    IOobject
    (
        "transportProperties",
        runTime.constant(),
        mesh,
        IOobject::MUST_READ_IF_MODIFIED,
        IOobject::NO_WRITE
    )
);

double viscosity = transportProperties.lookup("nu");
```

å¯ä»¥çœ‹åˆ° OpenFOAM çš„ä»£ç ï¼ŒåŸºäº `IOobject` å®ä½“ï¼Œæ„é€ äº† `IOdictionary` ç±»çš„ `transportProperties` å®ä½“ï¼Œè€Œ `IOobject` åˆ™æ˜¯åŸºäºæ–‡ä»¶ `"transportProperties"` å’Œå…¶ä»–å‚æ•°æ„é€ çš„ã€‚è€Œ `transportProperties` ä½¿ç”¨å±äºçš„ `IOdictionary` ç±»çš„æ–¹æ³• `lookup()` æŒ‡å®šå…³é”®è¯ `"nu"` æ¥è¯»å–æ­¤å…³é”®è¯åçš„å‚æ•°å€¼ã€‚è™½ç„¶è¿™ä¸ªè¯­æ³•åœ¨ OpenFOAM ä¸­æœ‰ç‚¹è¿‡æ—¶ï¼Œä½†æ˜¯ç›¸å¯¹æ¥è¯´éå¸¸ç›´è§‚ã€‚

> ç°åœ¨æ›´å¤šçš„ä½¿ç”¨ `dimensionedScalar viscosity("nu", transportProperties)` è¿™ç§å†™æ³•ï¼Œæ›´åŠ çš„é¢å‘å¯¹è±¡ï¼Œè€Œéé¢å‘è¿‡ç¨‹ã€‚

ç®€å•æ¦‚æ‹¬å¦‚ä¸‹ï¼Œ

- `IOdictionary` æ˜¯å’Œæ–‡ä»¶è¯»å–ç›¸å…³çš„ç±»
- `IOdictionary` åŸºäºå¤–éƒ¨æ–‡ä»¶ `transportProperties` æ„é€ å®ä½“ `transportProperties`
- å®ä½“ `transportProperties` å…·æœ‰ `IOdictionary` ç±»çš„æ–¹æ³•
- ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ä½“ `transportProperties` å¯ä»¥ä½¿ç”¨ `lookup()` æ–¹æ³•

æˆ‘ä»¬å°è¯•è‡ªå·±åŠ¨æ‰‹æ¨¡ä»¿ï¼Œå®ç° OpenFOAM çš„è¿™ä¸ªè¯»å–åŠŸèƒ½ã€‚

### é¡¹ç›®å‡†å¤‡

å»ºç«‹æœ¬é¡¹ç›®æ–‡ä»¶å¤¹

```
// terminal
ofsp
mkdir ofsp_01_IO_keyword
```

æ•´ä½“çš„æ¶æ„å¦‚ä¸‹

```
ofsp_01_IO_keyword/
â”œâ”€â”€ IOdictionary/
â”‚Â Â  â”œâ”€â”€ IOdictionary.C
â”‚Â Â  â”œâ”€â”€ IOdictionary.H
â”‚Â Â  â””â”€â”€ Make/
â”‚Â Â      â”œâ”€â”€ files
â”‚Â Â      â””â”€â”€ options
â”œâ”€â”€ Make/
â”‚Â Â  â”œâ”€â”€ files
â”‚Â Â  â””â”€â”€ options
â”œâ”€â”€ ofsp_01_IO_keyword.C
â””â”€â”€ ofspProperties
```

è‡ªå®šä¹‰å­—å…¸æ–‡ä»¶ `ofspProperties` ä¸­æä¾›å’Œä¸ŠèŠ‚é¡¹ç›®ç›¸åŒçš„å†…å®¹ã€‚

### è‡ªå®šä¹‰ IOdictionary

æˆ‘ä»¬è®¾æƒ³ï¼Œè‡ªå®šä¹‰çš„ `IOdictionary` ç±»ä¹Ÿå¯ä»¥æœ‰ç±»ä¼¼ OpenFOAM çš„è¯­æ³•è¡¨è¾¾ã€‚ç®€åŒ–çš„å½¢å¼å¦‚ä¸‹

```cpp
// æƒ³è¦çš„è¯­æ³•æ•ˆæœ
IOdictionary ofspProperties // æ„é€ ç±»çš„å®ä½“
(
	"ofspProperties" // å¤–éƒ¨æ–‡ä»¶çš„åç§°ï¼Œæ ¹ç›®å½•è·¯å¾„
);

double viscosity = ofspProperties.lookup("nu"); // ç±»çš„å®ä½“å¯ä»¥ä½¿ç”¨æ–¹æ³•
```

å…¶ä¸­ï¼Œ`ofspProperties` æ˜¯ `IOdictionary` ç±»çš„å®ä¾‹åŒ–ã€‚

å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè‡ªå®šä¹‰çš„ `IOdictionary` ç±»éœ€è¦è¯»å–å¤–éƒ¨æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ä»ç„¶è¦ä½¿ç”¨ C++ åŸç”Ÿ `fstream` ç±»ã€‚

åœ¨ç±»çš„å£°æ˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰ä¸€ä¸ªè‡ªå·±çš„å‘½åç©ºé—´ï¼Œé¿å…é”™è¯¯è°ƒç”¨ã€‚

ç±»çš„å£°æ˜ `IOdictionary.H` å†…å®¹å¦‚ä¸‹

```cpp
#pragma once

#include <iostream>
#include <fstream>
#include <string>

namespace Aerosand // è‡ªå®šä¹‰å‘½åç©ºé—´ï¼Œé¿å…å‘½åé‡å¤
{

class IOdictionary
{
    
private:
    std::ifstream dictionary_;
    std::string filePath_;

public:

    // Constructor

        IOdictionary(const std::string& filePath);

    // Destructor

        ~IOdictionary();

    // Member Function

        std::string lookup(const std::string& keyword);

};

}
```

ç±»çš„å®šä¹‰ `IOdictionary.C` å†…å®¹å¦‚ä¸‹

```cpp
#include "IOdictionary.H"

// Constructor

Aerosand::IOdictionary::IOdictionary(const std::string& filePath)
{
    filePath_ = filePath;
}

// Destructor

Aerosand::IOdictionary::~IOdictionary()
{
    if (dictionary_.is_open())
    {
        dictionary_.close();
    }
}

// Member Function

std::string Aerosand::IOdictionary::lookup(const std::string& keyword)
{
    dictionary_.open(filePath_);

    std::string returnValue;

    std::string line;

    while (std::getline(dictionary_, line))
    {
	    // æˆªå–å…³é”®è¯åçš„å­—ç¬¦ä¸²
        size_t keywordPos = line.find(keyword);
        if (keywordPos != std::string::npos)
        {
            returnValue = line.substr(keywordPos + keyword.length());
        }

		// å‰”é™¤æ‰€æœ‰çš„ç©ºæ ¼
        size_t spacePos = returnValue.find(" ");
        while (spacePos != std::string::npos)
        {
            returnValue.erase(spacePos, 1);
            spacePos = returnValue.find(" ");
        }
    }

    dictionary_.close(); 

    return returnValue;
}

```

###  åº“ Make

æ–‡ä»¶ `IOdictionary/Make/files` å†…å®¹å¦‚ä¸‹

```cpp
IOdictionary.C

LIB = $(FOAM_USER_LIBBIN)/libIOdictionary
```

æ–‡ä»¶ `IOdictionary/Make/options` ç•™ç©ºã€‚

ç¼–è¯‘ç”ŸæˆåŠ¨æ€åº“

```terminal
// terminal
wclean IOdictionary
wmake IOdictionary
```

### ä¸»æºç 

é‡å†™ä¸»æºç ï¼Œå†…å®¹å¦‚ä¸‹

```cpp
#include <iostream>
#include <fstream>

#include "IOdictionary.H"

int main(int argc, char const *argv[])
{
    Aerosand::IOdictionary ofspProperties("ofspProperties");

    std::string viscosity = ofspProperties.lookup("nu");
    std::string application = ofspProperties.lookup("application");
    std::string deltaT = ofspProperties.lookup("deltaT");
    std::string writeInterval = ofspProperties.lookup("writeInterval");
    std::string purgeWrite = ofspProperties.lookup("purgeWrite");

    std::cout << "nu\t\t" << viscosity << std::endl;
    std::cout << "application\t" << application << std::endl;
    std::cout << "deltaT\t\t" << deltaT << std::endl;
    std::cout << "writeInterval\t" << writeInterval << std::endl;
    std::cout << "purgeWrite\t" << purgeWrite << std::endl;

    return 0;
}
```

### é¡¹ç›® Make

æ–‡ä»¶ `ofsp_01_IO_keyword/Make/files` å†…å®¹å¦‚ä¸‹

```cpp
ofsp_01_IO_keyword.C

EXE = $(FOAM_USER_APPBIN)/ofsp_01_IO_keyword

```

æ–‡ä»¶ `ofsp_01_IO_keyword/Make/options` å†…å®¹å¦‚ä¸‹

```cpp
EXE_INC = \
    -IIOdictionary/lnInclude

EXE_LIBS = \
    -L$(FOAM_USER_LIBBIN) \
    -lIOdictionary

```

### ç¼–è¯‘è¿è¡Œ

ç»ˆç«¯æ‰§è¡Œ

```terminal
// terminal
wclean
wmake

ofsp_01_IO_keyword
```

ç»ˆç«¯è¾“å‡ºç»“æœå¦‚ä¸‹

```
nu              0.01
application     laplacianFoam
deltaT          0.005
writeInterval   20
purgeWrite      0
```

å³ä½¿æˆ‘ä»¬æ›´æ¢å­—å…¸æ–‡ä»¶ä¸­å†…å®¹çš„é¡ºåºï¼Œæˆ–è€…å¢åŠ æ–°çš„å…³é”®è¯ï¼Œéƒ½ä¸ä¼šå½±å“è¯¥é¡¹ç›®æŒ‰å…³é”®è¯è¯»å…¥å–å€¼ã€‚

é‡æ„é¡¹ç›®çš„æ€è·¯åŸºæœ¬æ­£ç¡®ã€‚ä½†æ˜¯è¯»å–å¾—åˆ°çš„å‚æ•°ç±»å‹ç»Ÿä¸€æ˜¯ `string` ç±»å‹ï¼Œä¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥å¼€å‘åŠŸèƒ½ç‰¹æ€§ã€‚

## å¼€å‘ç‰¹æ€§

è¿™é‡Œæœ‰ä¸€äº›ä½œè€…å…³äºç‰ˆæœ¬å­˜æ¡£çš„å»ºè®®ï¼ˆæš‚ä¸ä½¿ç”¨ git æ§åˆ¶ç‰ˆæœ¬ï¼‰ã€‚

å½“å¯¹é¡¹ç›®æœ‰æ–°çš„æƒ³æ³•å¢åŠ æˆ–è€…æ”¹è¿›çš„æ—¶å€™ï¼Œå»ºè®®æ‹·è´è‡³é¡¹ç›®ï¼Œåœ¨æ–°é¡¹ç›®ä¸Šè¿›è¡Œä¿®æ”¹å’Œå¼€å‘ï¼Œä¿ç•™åŸå§‹æ–‡ä»¶ä»¥ä¾¿å›æ»šç‰ˆæœ¬ã€‚

### é¡¹ç›®å‡†å¤‡

å»ºç«‹æœ¬é¡¹ç›®æ–‡ä»¶å¤¹

```
// terminal
ofsp
cp -r ofsp_01_IO_keyword ofsp_01_IO_feature
cd ofsp_01_IO_feature
wclean IOdictionary
wclean

mv ofsp_01_IO_keyword.C ofsp_01_IO_feature.C
sed -i s/"IO_keyword"/"IO_feature"/g Make/files
```

æ•´ä½“çš„æ¶æ„å¦‚ä¸‹

```
ofsp_01_IO_feature/
â”œâ”€â”€ IOdictionary/
â”‚Â Â  â”œâ”€â”€ IOdictionary.C
â”‚Â Â  â”œâ”€â”€ IOdictionary.H
â”‚Â Â  â””â”€â”€ Make/
â”‚Â Â      â”œâ”€â”€ files
â”‚Â Â      â””â”€â”€ options
â”œâ”€â”€ Make/
â”‚Â Â  â”œâ”€â”€ files
â”‚Â Â  â””â”€â”€ options
â”œâ”€â”€ ofsp_01_IO_feature.C
â””â”€â”€ ofspProperties
```

å¼€å‘åº“å’Œä¸»ç¨‹åºçš„ `Make` å‚è€ƒä¸ŠèŠ‚é¡¹ç›®è¿›è¡Œä¿®æ”¹ã€‚

è‡ªå®šä¹‰å­—å…¸æ–‡ä»¶ `ofspProperties` ä¸­æä¾›å’Œä¸ŠèŠ‚é¡¹ç›®ç›¸åŒçš„å†…å®¹ã€‚

### åŒºåˆ†å‚æ•°ç±»å‹

å½“æˆ‘ä»¬æ‹¿åˆ° `string` ç±»å‹çš„è¿”å›å€¼åï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¯¥è¿”å›å€¼è½¬æ¢æˆæˆ‘ä»¬éœ€è¦çš„ç±»å‹ã€‚

#### å¼€å‘è®¾è®¡æ€è·¯

è€ƒè™‘å‡½æ•° `lookup()` éœ€è¦è¯»å…¥å„ç§æ•°æ®ç±»å‹ï¼Œä»¥åŠè¦è¿”å›ç»™ä¸»ç¨‹åºå„ç§æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å°è¯•ä½¿ç”¨ C++ çš„æ¨¡æ¿ `template` è¿›è¡Œå¼€å‘ã€‚

#### ä»£ç æ”¹è¿›

æ”¹è¿›è‡ªå®šä¹‰å¼€å‘ç±» `IOdictionary`ï¼Œå£°æ˜å’Œå®šä¹‰å¦‚ä¸‹

ç±»çš„å£°æ˜ `IOdictionary.H` å†…å®¹å¦‚ä¸‹

```cpp
#pragma once

#include <iostream>
#include <fstream>
#include <string>
#include <sstream>

namespace Aerosand // è‡ªå®šä¹‰å‘½åç©ºé—´ï¼Œé¿å…å‘½åé‡å¤
{

class IOdictionary
{
    
private:
    std::ifstream dictionary_;
    std::string filePath_;

public:

    // Constructor

        IOdictionary(const std::string& filePath);

    // Destructor

        ~IOdictionary();

private:

    // Private Member Function

		// ç§æœ‰æˆå‘˜å‡½æ•°ï¼Œä»…åœ¨ç±»å†…ä½¿ç”¨
        template<typename T>
        T convertFromString(const std::string& str);

public:

    // Public Member Function

        template<typename T>
        T lookup(const std::string& keyword);

};


// Private Member Function

template<typename T>
T Aerosand::IOdictionary::convertFromString(const std::string& str)
{
    T value;
    std::istringstream iss(str);
    iss >> value;

    return value;
}

// Public Member Function

template<typename T>
T Aerosand::IOdictionary::lookup(const std::string& keyword)
{
    dictionary_.open(filePath_); // æ‰“å¼€æ–‡ä»¶

    T returnValue;

    std::string line; // è¯»å…¥è¡Œ
    std::string valueLine; // å¤„ç†è¡Œ

    while (std::getline(dictionary_, line)) // æŒ‰è¡Œè¯»å…¥
    {
		size_t keywordPos = line.find(keyword); // å…³é”®è¯çš„ç¬¬ä¸€ä¸ªå­—æ¯çš„ä½ç½®
		if (keywordPos != std::string::npos) // å¦‚æœèƒ½æ‰¾åˆ°å…³é”®è¯
		{
			// æˆªå–å…³é”®è¯åçš„å­—ç¬¦ä¸²ï¼ˆåŒ…å«ç©ºæ ¼ï¼‰
			valueLine = line.substr(keywordPos + keyword.length());
	
			// å‰”é™¤æ‰€æœ‰çš„ç©ºæ ¼
			size_t spacePos = valueLine.find(" ");
			while (spacePos != std::string::npos)
			{
				valueLine.erase(spacePos, 1);
				spacePos = valueLine.find(" ");
			}
		}
    }

    dictionary_.close(); // å…³é—­æ–‡ä»¶

    returnValue = convertFromString<T>(valueLine); // è½¬æ¢ä¸ºç”¨æˆ·æŒ‡å®šç±»å‹

    return returnValue;

}

}

```


> è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå› ä¸ºæ¨¡æ¿çš„ç¼–è¯‘æœºåˆ¶ä¸åŒï¼Œæˆ‘ä»¬æŠŠç±»å†…æ¨¡æ¿å‡½æ•°çš„å®šä¹‰å’Œå£°æ˜æ”¾åœ¨äº†åŒä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ†å¼€ä¼šå¯¼è‡´ä¸»ç¨‹åºæ‰¾ä¸åˆ°å‡½æ•°çš„å®ä¾‹åŒ–å¯¹è±¡ã€‚å› ä¸ºæ¶‰åŠåˆ°äº†æ›´å¤šçš„ C++ çŸ¥è¯†ï¼Œè¿™é‡Œæš‚ä¸æ·±ç©¶ï¼ŒçŸ¥é“è¿™ä¹ˆå¤„ç†å°±å¯ä»¥äº†ã€‚

ç±»çš„å®šä¹‰ `IOdictionary.C` å†…å®¹ç›¸åº”çš„ä¿®æ”¹ä¸º

```cpp
#include "IOdictionary.H"

// Constructor

Aerosand::IOdictionary::IOdictionary(const std::string& filePath)
{
    filePath_ = filePath;
}

// Destructor

Aerosand::IOdictionary::~IOdictionary() // å…¶å® C++ ä¼šè‡ªåŠ¨å…³é—­
{
    if (dictionary_.is_open())
    {
        dictionary_.close();
    }
}

```

ç”±æ­¤ä»¥æ¥ï¼Œä¸»æºç  `ofsp_01_IO_feature.C` çš„å†™æ³•å¦‚ä¸‹

```cpp
#include <iostream>
#include <fstream>
#include <string>

#include "IOdictionary.H"

int main(int argc, char const *argv[])
{
    Aerosand::IOdictionary ofspProperties("ofspProperties"); // è°ƒç”¨æ„é€ å‡½æ•°

	// è°ƒç”¨æ¨¡æ¿å‡½æ•°
    double viscosity = ofspProperties.lookup<double>("nu");
    std::string application = ofspProperties.lookup<std::string>("application");
    double deltaT = ofspProperties.lookup<double>("deltaT");
    int writeInterval = ofspProperties.lookup<int>("writeInterval");
    bool purgeWrite = ofspProperties.lookup<bool>("purgeWrite");

    std::cout << "nu\t\t" << viscosity << std::endl;
    std::cout << "application\t" << application << std::endl;
    std::cout << "deltaT\t\t" << deltaT << std::endl;
    std::cout << "writeInterval\t" << writeInterval << std::endl;
    std::cout << "purgeWrite\t" << purgeWrite << std::endl;

	// éªŒè¯å‚æ•°è¯»å–çš„ç±»å‹æ­£ç¡®ï¼Œå¯ä»¥å‚ä¸è®¡ç®—
    std::cout << "\nWrite time interval = " << deltaT * writeInterval << std::endl;

    return 0;
}

```

#### æµ‹è¯•

ç¼–è¯‘è¿è¡Œ

```
// terminal
wmake IOdictionary
wmake

ofsp_01_IO_feature
```

ç»“æœå¦‚ä¸‹

```
nu              0.01
application     laplacianFoam
deltaT          0.005
writeInterval   20
purgeWrite      0

Write time interval = 0.1
```

å¯ä»¥çœ‹åˆ°è¯»å–åŠŸèƒ½æ­£å¸¸ï¼Œå¹¶ä¸”é€šè¿‡è®¡ç®—éªŒè¯äº†è¯»å–çš„å‚æ•°å€¼çš„ç±»å‹ä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚

### é£æ ¼å’Œæ³¨é‡Šå’ŒæŠ¥é”™

æœ‰äº†å‰æ–‡å¯¹å­—ç¬¦ä¸²çš„å¤„ç†çš„æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œè‡ªå®šä¹‰ç±»çš„é£æ ¼å¼€å‘è®¾è®¡ã€‚

#### å¼€å‘è®¾è®¡æ€è·¯

é£æ ¼çš„è®¾è®¡å‚è€ƒ C++ï¼Œæ¯è¡Œæœ«å°¾åŠ  `;` è¡¨ç¤ºè¯­å¥ç»“æŸï¼Œå¦‚ä¸‹æ‰€ç¤º

```cpp
nu         0.01;
```

æ³¨é‡Šçš„è®¾è®¡å‚è€ƒ C++ ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§å½¢å¼

```cpp
// nu is viscosity
nu                 0.01;

deltaT             0.005; // we can change deltaT
```

æŠ¥é”™çš„è®¾è®¡ç®€å•è€ƒè™‘æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µ

1. å­—å…¸æ–‡ä»¶ä¸å­˜åœ¨æˆ–è€…æ–‡ä»¶åç§°é”™è¯¯ï¼Œåº”è¯¥ç»ˆæ­¢ç¨‹åºå¹¶è¾“å‡ºå¯¹åº”çš„æŠ¥é”™ä¿¡æ¯
2. å­—å…¸ä¸­çš„å…³é”®è¯æ‰¾ä¸åˆ°ï¼Œåº”è¯¥ç»ˆæ­¢ç¨‹åºå¹¶è¾“å‡ºå¯¹åº”çš„æŠ¥é”™ä¿¡æ¯
3. å­—å…¸ä¸­çš„å…³é”®è¯å­˜åœ¨ï¼Œä½†æ˜¯æ²¡æœ‰ç»™å®šå€¼ï¼Œåº”è¯¥ç»ˆæ­¢ç¨‹åºå¹¶è¾“å‡ºå¯¹åº”çš„æŠ¥é”™ä¿¡æ¯

#### ä»£ç æ”¹è¿›

è‡ªå®šä¹‰ç±» `IOdictionary` éœ€è¦è¿›ä¸€æ­¥æ”¹è¿›ã€‚

ç±»çš„å£°æ˜ `IOdictionary.H` çš„å†…å®¹å¦‚ä¸‹

```cpp
#pragma once

#include <iostream>
#include <fstream>
#include <string>
#include <sstream>

namespace Aerosand // è‡ªå®šä¹‰å‘½åç©ºé—´ï¼Œé¿å…å‘½åé‡å¤
{

class IOdictionary
{
    
private:
    std::ifstream dictionary_;
    std::string filePath_;

public:

    // Constructor

        IOdictionary(const std::string& filePath);

    // Destructor

        ~IOdictionary();

private:

    // Private Member Function

		// ç§æœ‰æˆå‘˜å‡½æ•°ï¼Œä»…åœ¨ç±»å†…ä½¿ç”¨
        template<typename T>
        T convertFromString(const std::string& str);

public:

    // Public Member Function

        template<typename T>
        T lookup(const std::string& keyword);

};


// Private Member Function

template<typename T>
T Aerosand::IOdictionary::convertFromString(const std::string& str)
{
    T value;
    std::istringstream iss(str);
    iss >> value;

    return value;
}

// Public Member Function

template<typename T>
T Aerosand::IOdictionary::lookup(const std::string& keyword)
{
    dictionary_.open(filePath_); // æ‰“å¼€æ–‡ä»¶

    T returnValue;

    bool foundKeyword = false; // æ˜¯å¦æ‰¾åˆ°å…³é”®è¯çš„æŒ‡æ ‡

    std::string line; // è¯»å…¥è¡Œ
    std::string valueLine; // å¤„ç†è¡Œ

    while (std::getline(dictionary_, line)) // æŒ‰è¡Œè¯»å…¥
    {
        if (line.find("//") == 0) // è·³è¿‡è¡Œæ³¨é‡Š
        {
            continue;
        }

        size_t keywordPos = line.find(keyword); // å…³é”®è¯çš„ç¬¬ä¸€ä¸ªå­—æ¯çš„ä½ç½®
        if (keywordPos != std::string::npos) // å¦‚æœèƒ½æ‰¾åˆ°å…³é”®è¯
        {
            foundKeyword = true; // æ‰¾åˆ°å…³é”®è¯

            // æˆªå–å…³é”®è¯åçš„å­—ç¬¦ä¸²
            valueLine = line.substr(keywordPos + keyword.length());

			// æˆªå–åˆ†å·ä¹‹å‰çš„å­—ç¬¦ä¸²
            if (valueLine.find(";"))
            {
                valueLine = valueLine.substr(0,valueLine.find(";"));
            }

			// æˆªå– // ä¹‹å‰çš„å­—ç¬¦ä¸²ï¼Œå…¶å®å’Œä¸Šä¸€è¡Œå†—ä½™äº†
            if (valueLine.find("//") != std::string::npos)
            {
                valueLine = valueLine.substr(0, valueLine.find("//"));
            }

            // å‰”é™¤æ‰€æœ‰çš„ç©ºæ ¼
            size_t spacePos = valueLine.find(" ");
            while (spacePos != std::string::npos)
            {
                valueLine.erase(spacePos, 1);
                spacePos = valueLine.find(" ");
            }

			// å¦‚æœå¤„ç†å®Œå‘ç°æ²¡æœ‰å€¼ï¼ŒæŠ¥é”™
            if (valueLine.empty()){
                std::cerr << "\n--> AEROSAND FATAL ERROR: " << std::endl
                    << "cannot find value of " << keyword << std::endl
                    << std::endl;
                exit(1);
            }
        } 
    }

	// å¦‚æœæ²¡æœ‰æ‰¾åˆ°å…³é”®è¯ï¼ŒæŠ¥é”™
    if (!foundKeyword)
    {
        std::cerr << "\n--> AEROSAND FATAL ERROR: " << std::endl
            << "cannot find keyword " << keyword << std::endl
            << std::endl;
        exit(1);
    }

    dictionary_.close(); // å…³é—­æ–‡ä»¶

    returnValue = convertFromString<T>(valueLine); // è½¬æ¢ä¸ºç”¨æˆ·æŒ‡å®šç±»å‹

    return returnValue;

}

}

```

ç±»çš„å®šä¹‰ `IOdictionary.C` å†…å®¹å¦‚ä¸‹

```cpp
#include "IOdictionary.H"

// Constructor

Aerosand::IOdictionary::IOdictionary(const std::string& filePath)
{
    filePath_ = filePath;
    
    dictionary_.open(filePath_);
    if (!dictionary_.is_open()) // å¦‚æœæ‰“å¼€å¤±è´¥ï¼ŒæŠ¥é”™
    {
        std::cerr << "\n--> AEROSAND FATAL ERROR: " << std::endl
            << "cannot find file \"" << filePath_ << "\"\n" << std::endl
            << std::endl;
        exit(1);
    }
    dictionary_.close();
}

// Destructor

Aerosand::IOdictionary::~IOdictionary() // å…¶å® C++ ä¼šè‡ªåŠ¨å…³é—­
{
    if (dictionary_.is_open())
    {
        dictionary_.close();
    }
}

```

#### æµ‹è¯•

ä¿®æ”¹æœ¬åœ°å­—å…¸ `ofspProperties` å†…å®¹å¦‚ä¸‹

```
// This is ofspProperties.

nu                  0.02; // see the difference

// test
deltaT              0.005; 
writeInterval       20;
purgeWrite          0;  // test


application         laplacianFoam;
```

é‡æ–°ç¼–è¯‘ï¼Œè¯»è€…å¯ä»¥æµ‹è¯•å­—å…¸æ–‡ä»¶å¯èƒ½å‡ºç°çš„å¤šç§æƒ…å†µï¼Œå¯ä»¥å‘ç°ç»“æœæ»¡è¶³è®¾è®¡è¦æ±‚ã€‚

### å¼€å‘å°ç»“

åœ¨å¼€å‘ç‰¹æ€§çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æ„è¯†åˆ°è¯»å–æ“ä½œéœ€è¦é¢å¯¹çš„æ•°æ®ç±»å‹è¿˜æœ‰å¾ˆå¤šï¼Œç‰¹åˆ«æ˜¯ OpenFOAM è‡ªå·±çš„ç±»å‹ã€‚è€Œä¸”ï¼Œéœ€è¦å¤„ç†çš„ OpenFOAM è¾“å…¥æ–‡ä»¶æ ¼å¼å’Œå¼‚å¸¸å¤„ç†ä¹Ÿæœ‰å¾ˆå¤šã€‚è¿™äº›åŠŸèƒ½ç‰¹æ€§æ¯«æ— ç–‘é—®éœ€è¦æ›´å¥½çš„ç¨‹åºæ¶æ„å’Œæ›´å¤šçš„ç¨‹åºå¼€å‘ã€‚

å€¼çš„é«˜å…´çš„æ˜¯ï¼Œé€šè¿‡æˆ‘ä»¬è‡ªå·±åŠ¨æ‰‹å¼€å‘è¾“å…¥è¾“å‡ºåŠŸèƒ½ï¼Œç›¸ä¿¡ç°åœ¨å¯¹ OpenFOAM çš„å­—å…¸æ–‡ä»¶å·²ç»æœ‰äº†ä¸€å®šçš„æ¦‚å¿µã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹ä¸€çœ‹ OpenFOAM ä¸ºæˆ‘ä»¬æä¾›çš„è¾“å…¥è¾“å‡ºæ–¹æ³•ã€‚

## OpenFOAM å®ç°

OpenFOAM çš„åº”ç”¨ä¸€èˆ¬éœ€è¦ä» case ä¸­è¯»å–å­—å…¸ï¼Œå‘ case ä¸­è¾“å‡ºè®¡ç®—ç»“æœç­‰ç­‰ã€‚

OpenFOAM æ˜¯æ€ä¹ˆå®ç°ä»æ–‡ä»¶å¤¹è¯»å–å’Œå†™å…¥çš„å‘¢ï¼ŸOpenFOAM çš„è¯»å–å’Œå†™å…¥æ›´åŠ é«˜çº§ï¼ŒæŒ‰å…³é”®è¯è¿›è¡Œç´¢å¼•æŸ¥æ‰¾çš„æ–¹æ³•ç›´æ¥å°è£…åœ¨äº†ç›¸å…³çš„ç±»ä¸­ï¼Œç›´æ¥ä½¿ç”¨æ–¹æ³•å³å¯ï¼Œæš‚æ—¶ä¸ç”¨æ·±ç©¶åˆ°å®ç°çš„ä»£ç å±‚é¢ã€‚

### é¡¹ç›®å‡†å¤‡

```
// terminal
ofsp
foamNewApp ofsp_01_IO
cd ofsp_01_IO
cp -r $FOAM_TUTORIALS/incompressible/icoFoam/cavity/cavity debug_case
```

æ–‡ä»¶ç»“æ„å¦‚ä¸‹

```
ofsp_01_IO/
â”œâ”€â”€ caseclean
â”œâ”€â”€ caserun
â”œâ”€â”€ debug_case/
â”‚Â Â  â”œâ”€â”€ 0/
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ p
â”‚Â Â  â”‚Â Â  â””â”€â”€ U
â”‚Â Â  â”œâ”€â”€ constant/
â”‚Â Â  â”‚Â Â  â””â”€â”€ transportProperties
â”‚Â Â  â””â”€â”€ system/
â”‚Â Â      â”œâ”€â”€ blockMeshDict
â”‚Â Â      â”œâ”€â”€ controlDict
â”‚Â Â      â”œâ”€â”€ decomposeParDict
â”‚Â Â      â”œâ”€â”€ fvSchemes
â”‚Â Â      â”œâ”€â”€ fvSolution
â”‚Â Â      â””â”€â”€ PDRblockMeshDict
â”œâ”€â”€ Make/
â”‚Â Â  â”œâ”€â”€ files
â”‚Â Â  â””â”€â”€ options
â”œâ”€â”€ ofsp_01_IO.C
â””â”€â”€ README.md
```

### è„šæœ¬å’Œè¯´æ˜

è„šæœ¬å’Œä¸Šä¸€ç¯‡è®¨è®ºçš„ç±»ä¼¼ï¼Œä¿®æ”¹è„šæœ¬å†…çš„æ±‚è§£å™¨åç§°å³å¯ã€‚

è„šæœ¬ `caserun` ä¸»è¦æ˜¯è´Ÿè´£åº”ç”¨ç¼–è¯‘æˆåŠŸåï¼Œè°ƒè¯•ç®—ä¾‹çš„è¿è¡Œï¼Œæš‚æ—¶å†™å…¥å¦‚ä¸‹å†…å®¹

```
#!/bin/bash

blockMesh -case debug_case | tee debug_case/log.mesh
echo "Meshing done."

ofsp_01_IO -case debug_case | tee debug_case/log.run
```

`caseclean` è„šæœ¬ä¸»è¦æ˜¯è´Ÿè´£æ¸…ç†åº”ç”¨åˆ°åˆ°ç¼–è¯‘å‰çŠ¶æ€ï¼Œå¦‚æœåº”ç”¨è¦ä¿®æ”¹ï¼Œé‚£ä¹ˆæµ‹è¯•ç®—ä¾‹ä¹Ÿè¦è¿˜åŸåˆ°è¿è¡Œå‰çš„çŠ¶æ€ï¼Œæ‰€ä»¥æš‚æ—¶å†™å…¥å¦‚ä¸‹å†…å®¹

```
#!/bin/bash

wclean
rm -rf debug_case/log.*
foamCleanTutorials debug_case
echo "Cleaning done."
```

`README.md` å†™å…¥éœ€è¦è¯´æ˜çš„å†…å®¹ã€‚

> ä»¥åé™¤éæœ‰ç‰¹åˆ«æƒ…å†µï¼Œä¸å†èµ˜è¿°è„šæœ¬å’Œè¯´æ˜

### ä¸»æºç 

ä¸»æºç å¦‚ä¸‹

```cpp
#include "fvCFD.H"

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

int main(int argc, char *argv[])
{
    #include "setRootCase.H"
    #include "createTime.H"

    #include "createMesh.H"


    /* 
    * Reading from the dictionary
    */
    const word dictName("customProperties"); // åˆ›å»ºwordç±»å‹å˜é‡ä¿å­˜å­—å…¸åç§°
    IOobject dictIO // æ„é€  IOobject ç±»å‹å˜é‡
    (
        dictName, // å­—å…¸åç§°
        runTime.constant(), // å­—å…¸ä½ç½®
        mesh, // å’Œmeshç›¸å…³
        IOobject::MUST_READ, // å¿…é¡»ä»å­—å…¸è¯»å–
        IOobject::NO_WRITE // ä¸å‘å­—å…¸å†™å…¥
    );

    if (!dictIO.typeHeaderOk<dictionary>(true))
    {
        FatalErrorIn(args.executable()) << "Cannot open specified dictionary"
            << dictName << exit(FatalError);
    }
    // å¦‚æœå­—å…¸æ–‡ä»¶åœ¨æ–‡ä»¶å¤´ä¸­æŒ‡å®šçš„ä¸æ˜¯ dictionary ç±»å‹ï¼Œåˆ™æŠ¥é”™

    dictionary myDictionary;
    myDictionary = IOdictionary(dictIO);
    // ä»IOobjectå˜é‡ä¸­åˆ›å»ºå­—å…¸å¯¹è±¡

    // ä¸€èˆ¬ä½¿ç”¨ä¸‹é¢è¿™ç§ç´§å‡‘å†™æ³•
    Info<< "Reading myProperties\n" << endl; 
    IOdictionary myProperties // å­—å…¸å˜é‡åå’Œå­—å…¸æ–‡ä»¶åå–ç›¸åŒ
    (
        IOobject
        (
            "myProperties",
            runTime.constant(),
            mesh,
            IOobject::MUST_READ,
            IOobject::NO_WRITE
        )
    );

    word solver; // åˆ›å»ºwordç±»å‹å˜é‡
    myProperties.lookup("application") >> solver;
    // ä»myPropertiesæ–‡ä»¶ä¸­æŸ¥æ‰¾åˆ°å…³é”®è¯ï¼Œå¹¶å–å€¼èµ‹ç»™solver

    word format(myProperties.lookup("writeFormat"));
    // æˆ–è€…å†™æˆæ›´ç´§å‡‘çš„å½¢å¼

    scalar timeStep(myProperties.lookupOrDefault("deltaT", scalar(0.01)));
    // ä¹Ÿå¯ä»¥å†™æˆ
    // scalar timeStep(myProperties.lookupOrDefault<scalar>("deltaT", 0.01));
    // å¦‚æœå­—å…¸ä¸­æ²¡æœ‰æä¾›è¿™ä¸€å…³é”®è¯ï¼Œåˆ™ä½¿ç”¨æ­¤å¥æä¾›çš„é»˜è®¤å€¼

    dimensionedScalar alpha("alpha",dimless,myProperties);
    // å¸¸ç”¨è¿™ç§è¯­æ³•è¯»å–å­—å…¸ä¸­çš„å‚æ•°
    
    dimensionedScalar beta(myProperties.lookup("beta"));
    // è¿™ç§å†™æ³•åœ¨è€ä»£ç ä¸­å¸¸è§ï¼Œä½†æ˜¯åœ¨æ–°ä¸€äº›çš„ç‰ˆæœ¬ä¸­ï¼Œç¼–è¯‘è™½ç„¶èƒ½è¿‡ï¼Œä½†æ˜¯æé†’è¯­æ³•è¿‡æ—¶


    bool ifPurgeWrite(myProperties.lookupOrDefault<Switch>("purgeWrite",0));
    // boolç±»å‹ä¹Ÿå¯ä»¥æŒ‰å…³é”®è¯æŸ¥æ‰¾å¹¶è¯»å–

    List<scalar> pointList(myProperties.lookup("point"));
    // åˆ—è¡¨ä¹Ÿå¯ä»¥è¯»å–

    HashTable<vector,word> sourceField(myProperties.lookup("source"));
    // å“ˆå¸Œè¡¨ä¹Ÿå¯ä»¥è¯»å–

	vector myVec = vector(myProperties.subDict("subDict").lookup("myVec"));
	// ä¹Ÿå¯ä»¥åœ¨å­—å…¸æ–‡ä»¶ä¸­å†ä½¿ç”¨å­å­—å…¸
	// æ³¨æ„åæ–‡å­—å…¸æ–‡ä»¶ä¸­çš„å­å­—å…¸å†™æ³•

	// è¾“å‡ºè¯»å–çš„å†…å®¹
    Info<< nl
        << "application: " << solver << nl << nl
        << "writeFormat: " << format << nl << nl
        << "deltaT: " << timeStep << nl << nl
        << "alpha: " << alpha << nl << nl
        << "beta: " << beta << nl << nl
        << "purgeWrite: " << ifPurgeWrite << nl << nl
        << "point: " << pointList << nl << nl
        << "source: " << sourceField << nl << nl
	    << "myVec: " << myVec << nl << nl
        << endl;

    /* 
    * Writing to files
    */
    fileName outputDir = runTime.path()/"processing"; // åˆ›å»ºoutputDirå˜é‡å¹¶èµ‹å€¼è·¯å¾„
    mkDir(outputDir); // åˆ›å»ºä¸Šå¥è·¯å¾„çš„æ–‡ä»¶å¤¹

    autoPtr<OFstream> outputFilePtr; // è¾“å‡ºæ–‡ä»¶æµçš„æŒ‡é’ˆ
    outputFilePtr.reset(new OFstream(outputDir/"myOutPut.dat")); // ç»™æŒ‡é’ˆå®šå‘

	// é€šè¿‡æŒ‡é’ˆç»™è¾“å‡ºæ–‡ä»¶å†™å…¥ä¿¡æ¯
    outputFilePtr() << "processing/myOutPut.dat" << endl;
    outputFilePtr() << "0 1 2 3 ..." << endl;
    sourceField.insert("U3", vector(1, 0.0, 0.0));
    outputFilePtr() << sourceField << endl;

    // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

    Info<< nl;
    runTime.printExecutionTime(Info);

    Info<< "End\n" << endl;

    return 0;
}

```

### å­—å…¸æ–‡ä»¶

æä¾›å­—å…¸æ–‡ä»¶ `debug_case/constant/customProperties`ï¼Œè¯¥å­—å…¸æ²¡æœ‰è¯»å–å†™å…¥æ“ä½œï¼Œåªéœ€è¦å†™ä¸Šæ­£ç¡®çš„æ–‡ä»¶å¤´ï¼Œå†…å®¹ç•™ç©ºå¤„ç†ã€‚

```cpp
FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    location    "constant";
    object      customProperties;
}

```

å­—å…¸æ–‡ä»¶ `debug_case/constant/myProperties` ï¼Œå†…å®¹å¦‚ä¸‹

```cpp
FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    location    "constant";
    object      myProperties;
}

application     icoFoam;

writeFormat     ascii;

purgeWrite      1;

alpha           0.2;
beta            beta [0 0 0 0 0 0 0]  0.5;

point
(
    0
    1
    2
);

source
(
    U1 (0 0 0)
    U2 (1 0 0)
);

subDict
{
    myVec (0.0 0.0 1.0);
}

```

### ç¼–è¯‘è¿è¡Œ

ç»ˆç«¯è¿è¡Œ

```
// terminal
wclean
wmake
./caseclean
./caserun
```

> ä»¥åä¸å†èµ˜è¿°ç®€å•çš„æ‰§è¡Œå‘½ä»¤

ç»ˆç«¯æ˜¾ç¤ºç»“æœå¦‚ä¸‹

```
// terminal

Create time

Create mesh for time = 0

Reading myProperties


application: icoFoam

writeFormat: ascii

deltaT: 0.01

alpha: alpha [0 0 0 0 0 0 0] 0.2

beta: beta [0 0 0 0 0 0 0] 0.5

purgeWrite: 1

point: 3(0 1 2)

source: 
2
(
U1 (0 0 0)
U2 (1 0 0)
)

myVec: (0 0 1)



ExecutionTime = 0 s  ClockTime = 0 s

End

```

å¦å¤–ç®—ä¾‹æ–‡ä»¶å¤¹ä¸‹æœ‰äº†ä¸€ä¸ªæ–°å»ºæ–‡ä»¶å¤¹ `debug_case/processing/`ï¼Œè·¯å¾„ä¸‹çš„ `myOutPut.dat` å†…å®¹å¦‚ä¸‹

```cpp
processing/myOutPut.dat
0 1 2 3 ...

3
(
U1 (0 0 0)
U3 (1 0 0)
U2 (1 0 0)
)

```

## å°ç»“

æˆ‘ä»¬åŒæ ·ä»æœ€ä¸€èˆ¬çš„ C++ åŸºç¡€æƒ…å†µåˆ‡å…¥ï¼Œäº†è§£äº†åŸºäºæ–‡ä»¶æµçš„è¾“å…¥è¾“å‡ºï¼Œä¹Ÿè®¨è®ºäº† OpenFOAM è®¾è®¡çš„æ–‡ä»¶æµè¾“å…¥è¾“å‡ºæ–¹æ³•ï¼Œä»¥åä¼šä¸æ–­åœ°ä½¿ç”¨æ–‡ä»¶æµè¾“å…¥è¾“å‡ºã€‚

